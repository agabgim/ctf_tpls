<center><a href="pinit.c">Actual source code: pinit.c</a></center><br>

<html>
<head> <link rel="canonical" href="http://www.mcs.anl.gov/petsc/petsc-current/src/sys/objects/pinit.c.html" />
<title></title>
<meta name="generator" content="c2html 0.9.4">
<meta name="date" content="2020-02-04T16:31:42+00:00">
</head>

<body bgcolor="#FFFFFF">
   <div id="version" align=right><b>petsc-3.12.4 2020-02-04</b></div>
   <div id="bugreport" align=right><a href="mailto:petsc-maint@mcs.anl.gov?subject=Typo or Error in Documentation &body=Please describe the typo or error in the documentation: petsc-3.12.4 v3.12.4 src/sys/objects/pinit.c.html "><small>Report Typos and Errors</small></a></div>
<pre width="80">

<a name="line2">  2: </a><font color="#B22222">/*</font>
<a name="line3">  3: </a><font color="#B22222">   This file defines the initialization of PETSc, including <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>()</font>
<a name="line4">  4: </a><font color="#B22222">*/</font>
<a name="line5">  5: </a> #include <A href="../../../include/petsc/private/petscimpl.h.html">&lt;petsc/private/petscimpl.h&gt;</A>
<a name="line6">  6: </a> #include <A href="../../../include/petscvalgrind.h.html">&lt;petscvalgrind.h&gt;</A>
<a name="line7">  7: </a> #include <A href="../../../include/petscviewer.h.html">&lt;petscviewer.h&gt;</A>

<a name="line9">  9: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line10"> 10: </a><strong><font color="#4169E1">PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscLogFinalize(void)</font></strong>;
<a name="line11"> 11: </a><font color="#A020F0">#endif</font>

<a name="line13"> 13: </a><font color="#A020F0">#if defined(PETSC_SERIALIZE_FUNCTIONS)</font>
<a name="line14"> 14: </a>PETSC_INTERN PetscFPT PetscFPTData;
<a name="line15"> 15: </a>PetscFPT PetscFPTData = 0;
<a name="line16"> 16: </a><font color="#A020F0">#endif</font>

<a name="line18"> 18: </a><font color="#A020F0">#if defined(PETSC_HAVE_SAWS)</font>
<a name="line19"> 19: </a> #include <A href="../../../include/petscviewersaws.h.html">&lt;petscviewersaws.h&gt;</A>
<a name="line20"> 20: </a><font color="#A020F0">#endif</font>

<a name="line22"> 22: </a><font color="#A020F0">#if defined(PETSC_HAVE_OPENMPI_MAJOR)</font>
<a name="line23"> 23: </a><font color="#A020F0">#include </font><font color="#666666">"mpi-ext.h"</font><font color="#A020F0"> </font><font color="#B22222">/* Needed for CUDA-aware check */</font><font color="#A020F0"></font>
<a name="line24"> 24: </a><font color="#A020F0">#endif</font>
<a name="line25"> 25: </a><font color="#B22222">/* -----------------------------------------------------------------------------------------*/</font>

<a name="line27"> 27: </a>PETSC_INTERN FILE *petsc_history;

<a name="line29"> 29: </a><strong><font color="#4169E1">PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscInitialize_DynamicLibraries(void)</font></strong>;
<a name="line30"> 30: </a><strong><font color="#4169E1">PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscFinalize_DynamicLibraries(void)</font></strong>;
<a name="line31"> 31: </a><strong><font color="#4169E1">PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscFunctionListPrintAll(void)</font></strong>;
<a name="line32"> 32: </a><strong><font color="#4169E1">PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscSequentialPhaseBegin_Private(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a>,int)</font></strong>;
<a name="line33"> 33: </a><strong><font color="#4169E1">PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscSequentialPhaseEnd_Private(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a>,int)</font></strong>;
<a name="line34"> 34: </a><strong><font color="#4169E1">PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscCloseHistoryFile(FILE**)</font></strong>;

<a name="line36"> 36: </a><font color="#B22222">/* user may set this BEFORE calling <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() */</font>
<a name="line37"> 37: </a><a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> = MPI_COMM_NULL;

<a name="line39"> 39: </a><a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> Petsc_Counter_keyval   = MPI_KEYVAL_INVALID;
<a name="line40"> 40: </a><a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> Petsc_InnerComm_keyval = MPI_KEYVAL_INVALID;
<a name="line41"> 41: </a><a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> Petsc_OuterComm_keyval = MPI_KEYVAL_INVALID;
<a name="line42"> 42: </a><a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> Petsc_ShmComm_keyval   = MPI_KEYVAL_INVALID;

<a name="line44"> 44: </a><font color="#B22222">/* Do not need put this in a guard like PETSC_HAVE_CUDA. Without configuring PETSc --with-cuda, users can still use option -use_gpu_aware_mpi */</font>
<a name="line45"> 45: </a><a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> use_gpu_aware_mpi = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line46"> 46: </a><font color="#A020F0">#if defined(PETSC_HAVE_CUDA)</font>
<a name="line47"> 47: </a><a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> sf_use_default_cuda_stream = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line48"> 48: </a><font color="#A020F0">#endif</font>

<a name="line50"> 50: </a><font color="#B22222">/*</font>
<a name="line51"> 51: </a><font color="#B22222">     Declare and set all the string names of the PETSc enums</font>
<a name="line52"> 52: </a><font color="#B22222">*/</font>
<a name="line53"> 53: </a>const char *const PetscBools[]     = {<font color="#666666">"FALSE"</font>,<font color="#666666">"TRUE"</font>,<font color="#666666">"<a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>"</font>,<font color="#666666">"PETSC_"</font>,0};
<a name="line54"> 54: </a>const char *const PetscCopyModes[] = {<font color="#666666">"COPY_VALUES"</font>,<font color="#666666">"OWN_POINTER"</font>,<font color="#666666">"USE_POINTER"</font>,<font color="#666666">"<a href="../../../docs/manualpages/Sys/PetscCopyMode.html#PetscCopyMode">PetscCopyMode</a>"</font>,<font color="#666666">"PETSC_"</font>,0};

<a name="line56"> 56: </a><a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> PetscPreLoadingUsed = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line57"> 57: </a><a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> PetscPreLoadingOn   = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;

<a name="line59"> 59: </a><a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> PetscHotRegionDepth;

<a name="line61"> 61: </a><font color="#A020F0">#if defined(PETSC_HAVE_THREADSAFETY)</font>
<a name="line62"> 62: </a>PetscSpinlock PetscViewerASCIISpinLockOpen;
<a name="line63"> 63: </a>PetscSpinlock PetscViewerASCIISpinLockStdout;
<a name="line64"> 64: </a>PetscSpinlock PetscViewerASCIISpinLockStderr;
<a name="line65"> 65: </a>PetscSpinlock PetscCommSpinLock;
<a name="line66"> 66: </a><font color="#A020F0">#endif</font>

<a name="line68"> 68: </a><font color="#B22222">/*</font>
<a name="line69"> 69: </a><font color="#B22222">       Checks the options database for initializations related to the</font>
<a name="line70"> 70: </a><font color="#B22222">    PETSc components</font>
<a name="line71"> 71: </a><font color="#B22222">*/</font>
<a name="line72"> 72: </a><strong><font color="#4169E1"><a name="PetscOptionsCheckInitial_Components"></a>PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  PetscOptionsCheckInitial_Components(void)</font></strong>
<a name="line73"> 73: </a>{
<a name="line74"> 74: </a>  <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      flg;

<a name="line78"> 78: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasHelp.html#PetscOptionsHasHelp">PetscOptionsHasHelp</a>(NULL,&amp;flg);
<a name="line79"> 79: </a>  <font color="#4169E1">if</font> (flg) {
<a name="line80"> 80: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line81"> 81: </a>    <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm = <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>;
<a name="line82"> 82: </a>    (*<a href="../../../docs/manualpages/Sys/PetscHelpPrintf.html#PetscHelpPrintf">PetscHelpPrintf</a>)(comm,<font color="#666666">"------Additional PETSc component options--------\n"</font>);
<a name="line83"> 83: </a>    (*<a href="../../../docs/manualpages/Sys/PetscHelpPrintf.html#PetscHelpPrintf">PetscHelpPrintf</a>)(comm,<font color="#666666">" -log_exclude: &lt;vec,mat,pc,ksp,snes,tao,ts&gt;\n"</font>);
<a name="line84"> 84: </a>    (*<a href="../../../docs/manualpages/Sys/PetscHelpPrintf.html#PetscHelpPrintf">PetscHelpPrintf</a>)(comm,<font color="#666666">" -info_exclude: &lt;null,vec,mat,pc,ksp,snes,tao,ts&gt;\n"</font>);
<a name="line85"> 85: </a>    (*<a href="../../../docs/manualpages/Sys/PetscHelpPrintf.html#PetscHelpPrintf">PetscHelpPrintf</a>)(comm,<font color="#666666">"-----------------------------------------------\n"</font>);
<a name="line86"> 86: </a><font color="#A020F0">#endif</font>
<a name="line87"> 87: </a>  }
<a name="line88"> 88: </a>  <font color="#4169E1">return</font>(0);
<a name="line89"> 89: </a>}

<a name="line91"> 91: </a><font color="#B22222">/*</font>
<a name="line92"> 92: </a><font color="#B22222">      PetscInitializeNoPointers - Calls <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() from C/C++ without the pointers to argc and args</font>

<a name="line94"> 94: </a><font color="#B22222">   Collective</font>

<a name="line96"> 96: </a><font color="#B22222">   Level: advanced</font>

<a name="line98"> 98: </a><font color="#B22222">    Notes:</font>
<a name="line99"> 99: </a><font color="#B22222">    this is called only by the PETSc Julia interface. Even though it might start MPI it sets the flag to</font>
<a name="line100">100: </a><font color="#B22222">     indicate that it did NOT start MPI so that the <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>() does not end MPI, thus allowing <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() to</font>
<a name="line101">101: </a><font color="#B22222">     be called multiple times from Julia without the problem of trying to initialize MPI more than once.</font>

<a name="line103">103: </a><font color="#B22222">     Developer Note: Turns off PETSc signal handling to allow Julia to manage signals</font>

<a name="line105">105: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeNoArguments.html#PetscInitializeNoArguments">PetscInitializeNoArguments</a>()</font>
<a name="line106">106: </a><font color="#B22222">*/</font>
<a name="line107">107: </a><strong><font color="#4169E1"><a name="PetscInitializeNoPointers"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  PetscInitializeNoPointers(int argc,char **args,const char *filename,const char *help)</font></strong>
<a name="line108">108: </a>{
<a name="line110">110: </a>  int            myargc   = argc;
<a name="line111">111: </a>  char           **myargs = args;

<a name="line114">114: </a>  <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(&amp;myargc,&amp;myargs,filename,help);<font color="#4169E1">if</font> (ierr) <font color="#4169E1">return</font> ierr;
<a name="line115">115: </a>  <a href="../../../docs/manualpages/Sys/PetscPopSignalHandler.html#PetscPopSignalHandler">PetscPopSignalHandler</a>();
<a name="line116">116: </a>  PetscBeganMPI = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line117">117: </a>  <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>(ierr);
<a name="line118">118: </a>}

<a name="line120">120: </a><font color="#B22222">/*</font>
<a name="line121">121: </a><font color="#B22222">      Used by Julia interface to get communicator</font>
<a name="line122">122: </a><font color="#B22222">*/</font>
<a name="line123">123: </a><strong><font color="#4169E1"><a name="PetscGetPETSC_COMM_SELF"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  PetscGetPETSC_COMM_SELF(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> *comm)</font></strong>
<a name="line124">124: </a>{
<a name="line126">126: </a>  *comm = <a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>;
<a name="line127">127: </a>  <font color="#4169E1">return</font>(0);
<a name="line128">128: </a>}

<a name="line130">130: </a><font color="#B22222">/*@C</font>
<a name="line131">131: </a><font color="#B22222">      <a href="../../../docs/manualpages/Sys/PetscInitializeNoArguments.html#PetscInitializeNoArguments">PetscInitializeNoArguments</a> - Calls <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() from C/C++ without</font>
<a name="line132">132: </a><font color="#B22222">        the command line arguments.</font>

<a name="line134">134: </a><font color="#B22222">   Collective</font>

<a name="line136">136: </a><font color="#B22222">   Level: advanced</font>

<a name="line138">138: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>()</font>
<a name="line139">139: </a><font color="#B22222">@*/</font>
<a name="line140">140: </a><strong><font color="#4169E1"><a name="PetscInitializeNoArguments"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscInitializeNoArguments.html#PetscInitializeNoArguments">PetscInitializeNoArguments</a>(void)</font></strong>
<a name="line141">141: </a>{
<a name="line143">143: </a>  int            argc   = 0;
<a name="line144">144: </a>  char           **args = 0;

<a name="line147">147: </a>  <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(&amp;argc,&amp;args,NULL,NULL);
<a name="line148">148: </a>  <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>(ierr);
<a name="line149">149: </a>}

<a name="line151">151: </a><font color="#B22222">/*@</font>
<a name="line152">152: </a><font color="#B22222">      <a href="../../../docs/manualpages/Sys/PetscInitialized.html#PetscInitialized">PetscInitialized</a> - Determine whether PETSc is initialized.</font>

<a name="line154">154: </a><font color="#B22222">   Level: beginner</font>

<a name="line156">156: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeNoArguments.html#PetscInitializeNoArguments">PetscInitializeNoArguments</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>()</font>
<a name="line157">157: </a><font color="#B22222">@*/</font>
<a name="line158">158: </a><strong><font color="#4169E1"><a name="PetscInitialized"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../docs/manualpages/Sys/PetscInitialized.html#PetscInitialized">PetscInitialized</a>(<a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>  *isInitialized)</font></strong>
<a name="line159">159: </a>{
<a name="line160">160: </a>  *isInitialized = PetscInitializeCalled;
<a name="line161">161: </a>  <font color="#4169E1">return</font> 0;
<a name="line162">162: </a>}

<a name="line164">164: </a><font color="#B22222">/*@</font>
<a name="line165">165: </a><font color="#B22222">      <a href="../../../docs/manualpages/Sys/PetscFinalized.html#PetscFinalized">PetscFinalized</a> - Determine whether <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>() has been called yet</font>

<a name="line167">167: </a><font color="#B22222">   Level: developer</font>

<a name="line169">169: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeNoArguments.html#PetscInitializeNoArguments">PetscInitializeNoArguments</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>()</font>
<a name="line170">170: </a><font color="#B22222">@*/</font>
<a name="line171">171: </a><strong><font color="#4169E1"><a name="PetscFinalized"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscFinalized.html#PetscFinalized">PetscFinalized</a>(<a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>  *isFinalized)</font></strong>
<a name="line172">172: </a>{
<a name="line173">173: </a>  *isFinalized = PetscFinalizeCalled;
<a name="line174">174: </a>  <font color="#4169E1">return</font> 0;
<a name="line175">175: </a>}

<a name="line177">177: </a><strong><font color="#4169E1">PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscOptionsCheckInitial_Private(void)</font></strong>;

<a name="line179">179: </a><font color="#B22222">/*</font>
<a name="line180">180: </a><font color="#B22222">       This function is the MPI reduction operation used to compute the sum of the</font>
<a name="line181">181: </a><font color="#B22222">   first half of the datatype and the max of the second half.</font>
<a name="line182">182: </a><font color="#B22222">*/</font>
<a name="line183">183: </a>MPI_Op MPIU_MAXSUM_OP = 0;

<a name="line185">185: </a><strong><font color="#4169E1"><a name="MPIU_MaxSum_Local"></a>PETSC_INTERN void MPIAPI MPIU_MaxSum_Local(void *in,void *out,int *cnt,MPI_Datatype *datatype)</font></strong>
<a name="line186">186: </a>{
<a name="line187">187: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>*)out,i,count = *cnt;

<a name="line190">190: </a>  <font color="#4169E1">if</font> (*datatype != MPIU_2INT) {
<a name="line191">191: </a>    (*<a href="../../../docs/manualpages/Sys/PetscErrorPrintf.html#PetscErrorPrintf">PetscErrorPrintf</a>)(<font color="#666666">"Can only handle MPIU_2INT data types"</font>);
<a name="line192">192: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Abort.html#MPI_Abort">MPI_Abort</a>(MPI_COMM_WORLD,1);
<a name="line193">193: </a>  }

<a name="line195">195: </a>  <font color="#4169E1">for</font> (i=0; i&lt;count; i++) {
<a name="line196">196: </a>    xout[2*i]    = <a href="../../../docs/manualpages/Sys/PetscMax.html#PetscMax">PetscMax</a>(xout[2*i],xin[2*i]);
<a name="line197">197: </a>    xout[2*i+1] += xin[2*i+1];
<a name="line198">198: </a>  }
<a name="line199">199: </a>  PetscFunctionReturnVoid();
<a name="line200">200: </a>}

<a name="line202">202: </a><font color="#B22222">/*</font>
<a name="line203">203: </a><font color="#B22222">    Returns the max of the first entry owned by this processor and the</font>
<a name="line204">204: </a><font color="#B22222">sum of the second entry.</font>

<a name="line206">206: </a><font color="#B22222">    The reason sizes[2*i] contains lengths sizes[2*i+1] contains flag of 1 if length is nonzero</font>
<a name="line207">207: </a><font color="#B22222">is so that the MPIU_MAXSUM_OP() can set TWO values, if we passed in only sizes[i] with lengths</font>
<a name="line208">208: </a><font color="#B22222">there would be no place to store the both needed results.</font>
<a name="line209">209: </a><font color="#B22222">*/</font>
<a name="line210">210: </a><strong><font color="#4169E1"><a name="PetscMaxSum"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  PetscMaxSum(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm,const <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> sizes[],<a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> *max,<a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> *sum)</font></strong>
<a name="line211">211: </a>{

<a name="line215">215: </a><font color="#A020F0">#if defined(PETSC_HAVE_MPI_REDUCE_SCATTER_BLOCK)</font>
<a name="line216">216: </a>  {
<a name="line217">217: </a>    <font color="#4169E1">struct</font> {<a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> max,sum;} work;
<a name="line218">218: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Reduce_scatter_block.html#MPI_Reduce_scatter_block">MPI_Reduce_scatter_block</a>((void*)sizes,&amp;work,1,MPIU_2INT,MPIU_MAXSUM_OP,comm);
<a name="line219">219: </a>    *max = work.max;
<a name="line220">220: </a>    *sum = work.sum;
<a name="line221">221: </a>  }
<a name="line222">222: </a><font color="#A020F0">#else</font>
<a name="line223">223: </a>  {
<a name="line224">224: </a>    <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>    size,rank;
<a name="line225">225: </a>    <font color="#4169E1">struct</font> {<a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> max,sum;} *work;
<a name="line226">226: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_size.html#MPI_Comm_size">MPI_Comm_size</a>(comm,&amp;size);
<a name="line227">227: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_rank.html#MPI_Comm_rank">MPI_Comm_rank</a>(comm,&amp;rank);
<a name="line228">228: </a>    <a href="../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(size,&amp;work);
<a name="line229">229: </a>    <a href="../../../docs/manualpages/Sys/MPIU_Allreduce.html#MPIU_Allreduce">MPIU_Allreduce</a>((void*)sizes,work,size,MPIU_2INT,MPIU_MAXSUM_OP,comm);
<a name="line230">230: </a>    *max = work[rank].max;
<a name="line231">231: </a>    *sum = work[rank].sum;
<a name="line232">232: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(work);
<a name="line233">233: </a>  }
<a name="line234">234: </a><font color="#A020F0">#endif</font>
<a name="line235">235: </a>  <font color="#4169E1">return</font>(0);
<a name="line236">236: </a>}

<a name="line238">238: </a><font color="#B22222">/* ----------------------------------------------------------------------------*/</font>

<a name="line240">240: </a><font color="#A020F0">#if (defined(PETSC_HAVE_COMPLEX) &amp;&amp; !defined(PETSC_HAVE_MPI_C_DOUBLE_COMPLEX)) || defined(PETSC_USE_REAL___FLOAT128) || defined(PETSC_USE_REAL___FP16)</font>
<a name="line241">241: </a>MPI_Op MPIU_SUM = 0;

<a name="line243">243: </a><strong><font color="#4169E1"><a name="PetscSum_Local"></a>PETSC_EXTERN void PetscSum_Local(void *in,void *out,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> *cnt,MPI_Datatype *datatype)</font></strong>
<a name="line244">244: </a>{
<a name="line245">245: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> i,count = *cnt;

<a name="line248">248: </a>  <font color="#4169E1">if</font> (*datatype == <a href="../../../docs/manualpages/Sys/MPIU_REAL.html#MPIU_REAL">MPIU_REAL</a>) {
<a name="line249">249: </a>    <a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>*)out;
<a name="line250">250: </a>    <font color="#4169E1">for</font> (i=0; i&lt;count; i++) xout[i] += xin[i];
<a name="line251">251: </a>  }
<a name="line252">252: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line253">253: </a>  <font color="#4169E1">else</font> <font color="#4169E1">if</font> (*datatype == <a href="../../../docs/manualpages/Sys/MPIU_COMPLEX.html#MPIU_COMPLEX">MPIU_COMPLEX</a>) {
<a name="line254">254: </a>    <a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a>*)out;
<a name="line255">255: </a>    <font color="#4169E1">for</font> (i=0; i&lt;count; i++) xout[i] += xin[i];
<a name="line256">256: </a>  }
<a name="line257">257: </a><font color="#A020F0">#endif</font>
<a name="line258">258: </a>  <font color="#4169E1">else</font> {
<a name="line259">259: </a>    (*<a href="../../../docs/manualpages/Sys/PetscErrorPrintf.html#PetscErrorPrintf">PetscErrorPrintf</a>)(<font color="#666666">"Can only handle <a href="../../../docs/manualpages/Sys/MPIU_REAL.html#MPIU_REAL">MPIU_REAL</a> or <a href="../../../docs/manualpages/Sys/MPIU_COMPLEX.html#MPIU_COMPLEX">MPIU_COMPLEX</a> data types"</font>);
<a name="line260">260: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Abort.html#MPI_Abort">MPI_Abort</a>(MPI_COMM_WORLD,1);
<a name="line261">261: </a>  }
<a name="line262">262: </a>  PetscFunctionReturnVoid();
<a name="line263">263: </a>}
<a name="line264">264: </a><font color="#A020F0">#endif</font>

<a name="line266">266: </a><font color="#A020F0">#if defined(PETSC_USE_REAL___FLOAT128) || defined(PETSC_USE_REAL___FP16)</font>
<a name="line267">267: </a>MPI_Op MPIU_MAX = 0;
<a name="line268">268: </a>MPI_Op MPIU_MIN = 0;

<a name="line270">270: </a><strong><font color="#4169E1"><a name="PetscMax_Local"></a>PETSC_EXTERN void PetscMax_Local(void *in,void *out,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> *cnt,MPI_Datatype *datatype)</font></strong>
<a name="line271">271: </a>{
<a name="line272">272: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> i,count = *cnt;

<a name="line275">275: </a>  <font color="#4169E1">if</font> (*datatype == <a href="../../../docs/manualpages/Sys/MPIU_REAL.html#MPIU_REAL">MPIU_REAL</a>) {
<a name="line276">276: </a>    <a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>*)out;
<a name="line277">277: </a>    <font color="#4169E1">for</font> (i=0; i&lt;count; i++) xout[i] = <a href="../../../docs/manualpages/Sys/PetscMax.html#PetscMax">PetscMax</a>(xout[i],xin[i]);
<a name="line278">278: </a>  }
<a name="line279">279: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line280">280: </a>  <font color="#4169E1">else</font> <font color="#4169E1">if</font> (*datatype == <a href="../../../docs/manualpages/Sys/MPIU_COMPLEX.html#MPIU_COMPLEX">MPIU_COMPLEX</a>) {
<a name="line281">281: </a>    <a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a>*)out;
<a name="line282">282: </a>    <font color="#4169E1">for</font> (i=0; i&lt;count; i++) {
<a name="line283">283: </a>      xout[i] = PetscRealPartComplex(xout[i])&lt;PetscRealPartComplex(xin[i]) ? xin[i] : xout[i];
<a name="line284">284: </a>    }
<a name="line285">285: </a>  }
<a name="line286">286: </a><font color="#A020F0">#endif</font>
<a name="line287">287: </a>  <font color="#4169E1">else</font> {
<a name="line288">288: </a>    (*<a href="../../../docs/manualpages/Sys/PetscErrorPrintf.html#PetscErrorPrintf">PetscErrorPrintf</a>)(<font color="#666666">"Can only handle <a href="../../../docs/manualpages/Sys/MPIU_REAL.html#MPIU_REAL">MPIU_REAL</a> or <a href="../../../docs/manualpages/Sys/MPIU_COMPLEX.html#MPIU_COMPLEX">MPIU_COMPLEX</a> data types"</font>);
<a name="line289">289: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Abort.html#MPI_Abort">MPI_Abort</a>(MPI_COMM_WORLD,1);
<a name="line290">290: </a>  }
<a name="line291">291: </a>  PetscFunctionReturnVoid();
<a name="line292">292: </a>}

<a name="line294">294: </a><strong><font color="#4169E1"><a name="PetscMin_Local"></a>PETSC_EXTERN void PetscMin_Local(void *in,void *out,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> *cnt,MPI_Datatype *datatype)</font></strong>
<a name="line295">295: </a>{
<a name="line296">296: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>    i,count = *cnt;

<a name="line299">299: </a>  <font color="#4169E1">if</font> (*datatype == <a href="../../../docs/manualpages/Sys/MPIU_REAL.html#MPIU_REAL">MPIU_REAL</a>) {
<a name="line300">300: </a>    <a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>*)out;
<a name="line301">301: </a>    <font color="#4169E1">for</font> (i=0; i&lt;count; i++) xout[i] = <a href="../../../docs/manualpages/Sys/PetscMin.html#PetscMin">PetscMin</a>(xout[i],xin[i]);
<a name="line302">302: </a>  }
<a name="line303">303: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line304">304: </a>  <font color="#4169E1">else</font> <font color="#4169E1">if</font> (*datatype == <a href="../../../docs/manualpages/Sys/MPIU_COMPLEX.html#MPIU_COMPLEX">MPIU_COMPLEX</a>) {
<a name="line305">305: </a>    <a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a>*)out;
<a name="line306">306: </a>    <font color="#4169E1">for</font> (i=0; i&lt;count; i++) {
<a name="line307">307: </a>      xout[i] = PetscRealPartComplex(xout[i])&gt;PetscRealPartComplex(xin[i]) ? xin[i] : xout[i];
<a name="line308">308: </a>    }
<a name="line309">309: </a>  }
<a name="line310">310: </a><font color="#A020F0">#endif</font>
<a name="line311">311: </a>  <font color="#4169E1">else</font> {
<a name="line312">312: </a>    (*<a href="../../../docs/manualpages/Sys/PetscErrorPrintf.html#PetscErrorPrintf">PetscErrorPrintf</a>)(<font color="#666666">"Can only handle <a href="../../../docs/manualpages/Sys/MPIU_REAL.html#MPIU_REAL">MPIU_REAL</a> or <a href="../../../docs/manualpages/Sys/MPIU_SCALAR.html#MPIU_SCALAR">MPIU_SCALAR</a> data (i.e. double or complex) types"</font>);
<a name="line313">313: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Abort.html#MPI_Abort">MPI_Abort</a>(MPI_COMM_WORLD,1);
<a name="line314">314: </a>  }
<a name="line315">315: </a>  PetscFunctionReturnVoid();
<a name="line316">316: </a>}
<a name="line317">317: </a><font color="#A020F0">#endif</font>

<a name="line319">319: </a><font color="#B22222">/*</font>
<a name="line320">320: </a><font color="#B22222">   Private routine to delete internal tag/name counter storage when a communicator is freed.</font>

<a name="line322">322: </a><font color="#B22222">   This is called by MPI, not by users. This is called by <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>() when the communicator that has this  data as an attribute is freed.</font>

<a name="line324">324: </a><font color="#B22222">   Note: this is declared extern "C" because it is passed to <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_create_keyval.html#MPI_Comm_create_keyval">MPI_Comm_create_keyval</a>()</font>

<a name="line326">326: </a><font color="#B22222">*/</font>
<a name="line327">327: </a><strong><font color="#4169E1"><a name="Petsc_DelCounter"></a>PETSC_EXTERN <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> MPIAPI Petsc_DelCounter(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> keyval,void *count_val,void *extra_state)</font></strong>
<a name="line328">328: </a>{

<a name="line332">332: </a>  PetscInfo1(0,<font color="#666666">"Deleting counter data in an <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> %ld\n"</font>,(long)comm);<a href="../../../docs/manualpages/Sys/CHKERRMPI.html#CHKERRMPI">CHKERRMPI</a>(ierr);
<a name="line333">333: </a>  <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(count_val);<a href="../../../docs/manualpages/Sys/CHKERRMPI.html#CHKERRMPI">CHKERRMPI</a>(ierr);
<a name="line334">334: </a>  <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>(MPI_SUCCESS);
<a name="line335">335: </a>}

<a name="line337">337: </a><font color="#B22222">/*</font>
<a name="line338">338: </a><font color="#B22222">  This is invoked on the outer comm as a result of either <a href="../../../docs/manualpages/Sys/PetscCommDestroy.html#PetscCommDestroy">PetscCommDestroy</a>() (via <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_delete_attr.html#MPI_Comm_delete_attr">MPI_Comm_delete_attr</a>) or when the user</font>
<a name="line339">339: </a><font color="#B22222">  calls <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>().</font>

<a name="line341">341: </a><font color="#B22222">  This is the only entry point for breaking the links between inner and outer comms.</font>

<a name="line343">343: </a><font color="#B22222">  This is called by MPI, not by users. This is called when <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>() is called on the communicator.</font>

<a name="line345">345: </a><font color="#B22222">  Note: this is declared extern "C" because it is passed to <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_create_keyval.html#MPI_Comm_create_keyval">MPI_Comm_create_keyval</a>()</font>

<a name="line347">347: </a><font color="#B22222">*/</font>
<a name="line348">348: </a><strong><font color="#4169E1"><a name="Petsc_DelComm_Outer"></a>PETSC_EXTERN <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> MPIAPI Petsc_DelComm_Outer(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> keyval,void *attr_val,void *extra_state)</font></strong>
<a name="line349">349: </a>{
<a name="line350">350: </a>  <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>                    ierr;
<a name="line351">351: </a>  <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>                       flg;
<a name="line352">352: </a>  <font color="#4169E1">union</font> {<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm; void *ptr;} icomm,ocomm;

<a name="line355">355: </a>  <font color="#4169E1">if</font> (keyval != Petsc_InnerComm_keyval) <a href="../../../docs/manualpages/Sys/SETERRMPI.html#SETERRMPI">SETERRMPI</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_ARG_CORRUPT,<font color="#666666">"Unexpected keyval"</font>);
<a name="line356">356: </a>  icomm.ptr = attr_val;

<a name="line358">358: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_get_attr.html#MPI_Comm_get_attr">MPI_Comm_get_attr</a>(icomm.comm,Petsc_OuterComm_keyval,&amp;ocomm,&amp;flg);<a href="../../../docs/manualpages/Sys/CHKERRMPI.html#CHKERRMPI">CHKERRMPI</a>(ierr);
<a name="line359">359: </a>  <font color="#4169E1">if</font> (!flg) <a href="../../../docs/manualpages/Sys/SETERRMPI.html#SETERRMPI">SETERRMPI</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_ARG_CORRUPT,<font color="#666666">"Inner <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> does not have expected reference to outer comm"</font>);
<a name="line360">360: </a>  <font color="#4169E1">if</font> (ocomm.comm != comm) <a href="../../../docs/manualpages/Sys/SETERRMPI.html#SETERRMPI">SETERRMPI</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_ARG_CORRUPT,<font color="#666666">"Inner <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> has reference to non-matching outer comm"</font>);
<a name="line361">361: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_delete_attr.html#MPI_Comm_delete_attr">MPI_Comm_delete_attr</a>(icomm.comm,Petsc_OuterComm_keyval);<a href="../../../docs/manualpages/Sys/CHKERRMPI.html#CHKERRMPI">CHKERRMPI</a>(ierr);
<a name="line362">362: </a>  PetscInfo1(0,<font color="#666666">"User <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> %ld is being freed after removing reference from inner PETSc comm to this outer comm\n"</font>,(long)comm);<a href="../../../docs/manualpages/Sys/CHKERRMPI.html#CHKERRMPI">CHKERRMPI</a>(ierr);
<a name="line363">363: </a>  <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>(MPI_SUCCESS);
<a name="line364">364: </a>}

<a name="line366">366: </a><font color="#B22222">/*</font>
<a name="line367">367: </a><font color="#B22222"> * This is invoked on the inner comm when Petsc_DelComm_Outer calls <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_delete_attr.html#MPI_Comm_delete_attr">MPI_Comm_delete_attr</a>.  It should not be reached any other way.</font>
<a name="line368">368: </a><font color="#B22222"> */</font>
<a name="line369">369: </a><strong><font color="#4169E1"><a name="Petsc_DelComm_Inner"></a>PETSC_EXTERN <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> MPIAPI Petsc_DelComm_Inner(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> keyval,void *attr_val,void *extra_state)</font></strong>
<a name="line370">370: </a>{

<a name="line374">374: </a>  PetscInfo1(0,<font color="#666666">"Removing reference to PETSc communicator embedded in a user <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> %ld\n"</font>,(long)comm);<a href="../../../docs/manualpages/Sys/CHKERRMPI.html#CHKERRMPI">CHKERRMPI</a>(ierr);
<a name="line375">375: </a>  <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>(MPI_SUCCESS);
<a name="line376">376: </a>}

<a name="line378">378: </a><strong><font color="#4169E1">PETSC_EXTERN <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> MPIAPI Petsc_DelComm_Shm(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a>,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>,void *,void *)</font></strong>;

<a name="line380">380: </a><font color="#A020F0">#if defined(PETSC_USE_PETSC_MPI_EXTERNAL32)</font>
<a name="line381">381: </a><strong><font color="#4169E1">PETSC_EXTERN <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> PetscDataRep_extent_fn(MPI_Datatype,MPI_Aint*,void*)</font></strong>;
<a name="line382">382: </a><strong><font color="#4169E1">PETSC_EXTERN <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> PetscDataRep_read_conv_fn(void*, MPI_Datatype,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>,void*,MPI_Offset,void*)</font></strong>;
<a name="line383">383: </a><strong><font color="#4169E1">PETSC_EXTERN <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> PetscDataRep_write_conv_fn(void*, MPI_Datatype,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>,void*,MPI_Offset,void*)</font></strong>;
<a name="line384">384: </a><font color="#A020F0">#endif</font>

<a name="line386">386: </a><a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> PETSC_MPI_ERROR_CLASS,PETSC_MPI_ERROR_CODE;

<a name="line388">388: </a>PETSC_INTERN int  PetscGlobalArgc;
<a name="line389">389: </a>PETSC_INTERN char **PetscGlobalArgs;
<a name="line390">390: </a>int  PetscGlobalArgc   = 0;
<a name="line391">391: </a>char **PetscGlobalArgs = 0;
<a name="line392">392: </a><a href="../../../docs/manualpages/Sys/PetscSegBuffer.html#PetscSegBuffer">PetscSegBuffer</a> PetscCitationsList;

<a name="line394">394: </a><strong><font color="#4169E1"><a name="PetscCitationsInitialize"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscCitationsInitialize(void)</font></strong>
<a name="line395">395: </a>{

<a name="line399">399: </a>  <a href="../../../docs/manualpages/Sys/PetscSegBufferCreate.html#PetscSegBufferCreate">PetscSegBufferCreate</a>(1,10000,&amp;PetscCitationsList);
<a name="line400">400: </a>  <a href="../../../docs/manualpages/Sys/PetscCitationsRegister.html#PetscCitationsRegister">PetscCitationsRegister</a>(<font color="#666666">"@TechReport{petsc-user-ref,\n  Author = {Satish Balay and Shrirang Abhyankar and Mark F. Adams and Jed Brown \n            and Peter Brune and Kris Buschelman and Lisandro Dalcin and\n            Victor Eijkhout and William D. Gropp and Dmitry Karpeyev and\n            Dinesh Kaushik and Matthew G. Knepley and Dave A. May and Lois Curfman McInnes\n            and Richard Tran Mills and Todd Munson and Karl Rupp and Patrick Sanan\n            and Barry F. Smith and Stefano Zampini and Hong Zhang and Hong Zhang},\n  Title = {{PETS}c Users Manual},\n  Number = {ANL-95/11 - Revision 3.11},\n  Institution = {Argonne National Laboratory},\n  Year = {2019}\n}\n"</font>,NULL);
<a name="line401">401: </a>  <a href="../../../docs/manualpages/Sys/PetscCitationsRegister.html#PetscCitationsRegister">PetscCitationsRegister</a>(<font color="#666666">"@InProceedings{petsc-efficient,\n  Author = {Satish Balay and William D. Gropp and Lois Curfman McInnes and Barry F. Smith},\n  Title = {Efficient Management of Parallelism in Object Oriented Numerical Software Libraries},\n  Booktitle = {Modern Software Tools in Scientific Computing},\n  Editor = {E. Arge and A. M. Bruaset and H. P. Langtangen},\n  Pages = {163--202},\n  Publisher = {Birkh{\\\"{a}}user Press},\n  Year = {1997}\n}\n"</font>,NULL);
<a name="line402">402: </a>  <font color="#4169E1">return</font>(0);
<a name="line403">403: </a>}

<a name="line405">405: </a>static char programname[PETSC_MAX_PATH_LEN] = <font color="#666666">""</font>; <font color="#B22222">/* HP includes entire path in name */</font>

<a name="line407">407: </a><strong><font color="#4169E1"><a name="PetscSetProgramName"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  PetscSetProgramName(const char name[])</font></strong>
<a name="line408">408: </a>{

<a name="line412">412: </a>  <a href="../../../docs/manualpages/Sys/PetscStrncpy.html#PetscStrncpy">PetscStrncpy</a>(programname,name,PETSC_MAX_PATH_LEN);
<a name="line413">413: </a>  <font color="#4169E1">return</font>(0);
<a name="line414">414: </a>}

<a name="line416">416: </a><font color="#B22222">/*@C</font>
<a name="line417">417: </a><font color="#B22222">    <a href="../../../docs/manualpages/Sys/PetscGetProgramName.html#PetscGetProgramName">PetscGetProgramName</a> - Gets the name of the running program.</font>

<a name="line419">419: </a><font color="#B22222">    Not Collective</font>

<a name="line421">421: </a><font color="#B22222">    Input Parameter:</font>
<a name="line422">422: </a><font color="#B22222">.   len - length of the string name</font>

<a name="line424">424: </a><font color="#B22222">    Output Parameter:</font>
<a name="line425">425: </a><font color="#B22222">.   name - the name of the running program</font>

<a name="line427">427: </a><font color="#B22222">   Level: advanced</font>

<a name="line429">429: </a><font color="#B22222">    Notes:</font>
<a name="line430">430: </a><font color="#B22222">    The name of the program is copied into the user-provided character</font>
<a name="line431">431: </a><font color="#B22222">    array of length len.  On some machines the program name includes</font>
<a name="line432">432: </a><font color="#B22222">    its entire path, so one should generally set len &gt;= PETSC_MAX_PATH_LEN.</font>
<a name="line433">433: </a><font color="#B22222">@*/</font>
<a name="line434">434: </a><strong><font color="#4169E1"><a name="PetscGetProgramName"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscGetProgramName.html#PetscGetProgramName">PetscGetProgramName</a>(char name[],size_t len)</font></strong>
<a name="line435">435: </a>{

<a name="line439">439: </a>   <a href="../../../docs/manualpages/Sys/PetscStrncpy.html#PetscStrncpy">PetscStrncpy</a>(name,programname,len);
<a name="line440">440: </a>  <font color="#4169E1">return</font>(0);
<a name="line441">441: </a>}

<a name="line443">443: </a><font color="#B22222">/*@C</font>
<a name="line444">444: </a><font color="#B22222">   <a href="../../../docs/manualpages/Sys/PetscGetArgs.html#PetscGetArgs">PetscGetArgs</a> - Allows you to access the raw command line arguments anywhere</font>
<a name="line445">445: </a><font color="#B22222">     after <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() is called but before <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>().</font>

<a name="line447">447: </a><font color="#B22222">   Not Collective</font>

<a name="line449">449: </a><font color="#B22222">   Output Parameters:</font>
<a name="line450">450: </a><font color="#B22222">+  argc - count of number of command line arguments</font>
<a name="line451">451: </a><font color="#B22222">-  args - the command line arguments</font>

<a name="line453">453: </a><font color="#B22222">   Level: intermediate</font>

<a name="line455">455: </a><font color="#B22222">   Notes:</font>
<a name="line456">456: </a><font color="#B22222">      This is usually used to pass the command line arguments into other libraries</font>
<a name="line457">457: </a><font color="#B22222">   that are called internally deep in PETSc or the application.</font>

<a name="line459">459: </a><font color="#B22222">      The first argument contains the program name as is normal for C arguments.</font>

<a name="line461">461: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>(), <a href="../../../docs/manualpages/Sys/PetscGetArguments.html#PetscGetArguments">PetscGetArguments</a>()</font>

<a name="line463">463: </a><font color="#B22222">@*/</font>
<a name="line464">464: </a><strong><font color="#4169E1"><a name="PetscGetArgs"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscGetArgs.html#PetscGetArgs">PetscGetArgs</a>(int *argc,char ***args)</font></strong>
<a name="line465">465: </a>{
<a name="line467">467: </a>  <font color="#4169E1">if</font> (!PetscInitializeCalled &amp;&amp; PetscFinalizeCalled) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_ORDER,<font color="#666666">"You must call after <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() but before <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>()"</font>);
<a name="line468">468: </a>  *argc = PetscGlobalArgc;
<a name="line469">469: </a>  *args = PetscGlobalArgs;
<a name="line470">470: </a>  <font color="#4169E1">return</font>(0);
<a name="line471">471: </a>}

<a name="line473">473: </a><font color="#B22222">/*@C</font>
<a name="line474">474: </a><font color="#B22222">   <a href="../../../docs/manualpages/Sys/PetscGetArguments.html#PetscGetArguments">PetscGetArguments</a> - Allows you to access the  command line arguments anywhere</font>
<a name="line475">475: </a><font color="#B22222">     after <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() is called but before <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>().</font>

<a name="line477">477: </a><font color="#B22222">   Not Collective</font>

<a name="line479">479: </a><font color="#B22222">   Output Parameters:</font>
<a name="line480">480: </a><font color="#B22222">.  args - the command line arguments</font>

<a name="line482">482: </a><font color="#B22222">   Level: intermediate</font>

<a name="line484">484: </a><font color="#B22222">   Notes:</font>
<a name="line485">485: </a><font color="#B22222">      This does NOT start with the program name and <a href="../../../docs/manualpages/IS/IS.html#IS">IS</a> null terminated (final arg is void)</font>

<a name="line487">487: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>(), <a href="../../../docs/manualpages/Sys/PetscGetArgs.html#PetscGetArgs">PetscGetArgs</a>(), <a href="../../../docs/manualpages/Sys/PetscFreeArguments.html#PetscFreeArguments">PetscFreeArguments</a>()</font>

<a name="line489">489: </a><font color="#B22222">@*/</font>
<a name="line490">490: </a><strong><font color="#4169E1"><a name="PetscGetArguments"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscGetArguments.html#PetscGetArguments">PetscGetArguments</a>(char ***args)</font></strong>
<a name="line491">491: </a>{
<a name="line492">492: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       i,argc = PetscGlobalArgc;

<a name="line496">496: </a>  <font color="#4169E1">if</font> (!PetscInitializeCalled &amp;&amp; PetscFinalizeCalled) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_ORDER,<font color="#666666">"You must call after <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() but before <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>()"</font>);
<a name="line497">497: </a>  <font color="#4169E1">if</font> (!argc) {*args = NULL; <font color="#4169E1">return</font>(0);}
<a name="line498">498: </a>  <a href="../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(argc,args);
<a name="line499">499: </a>  <font color="#4169E1">for</font> (i=0; i&lt;argc-1; i++) {
<a name="line500">500: </a>    <a href="../../../docs/manualpages/Sys/PetscStrallocpy.html#PetscStrallocpy">PetscStrallocpy</a>(PetscGlobalArgs[i+1],&amp;(*args)[i]);
<a name="line501">501: </a>  }
<a name="line502">502: </a>  (*args)[argc-1] = NULL;
<a name="line503">503: </a>  <font color="#4169E1">return</font>(0);
<a name="line504">504: </a>}

<a name="line506">506: </a><font color="#B22222">/*@C</font>
<a name="line507">507: </a><font color="#B22222">   <a href="../../../docs/manualpages/Sys/PetscFreeArguments.html#PetscFreeArguments">PetscFreeArguments</a> - Frees the memory obtained with <a href="../../../docs/manualpages/Sys/PetscGetArguments.html#PetscGetArguments">PetscGetArguments</a>()</font>

<a name="line509">509: </a><font color="#B22222">   Not Collective</font>

<a name="line511">511: </a><font color="#B22222">   Output Parameters:</font>
<a name="line512">512: </a><font color="#B22222">.  args - the command line arguments</font>

<a name="line514">514: </a><font color="#B22222">   Level: intermediate</font>

<a name="line516">516: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>(), <a href="../../../docs/manualpages/Sys/PetscGetArgs.html#PetscGetArgs">PetscGetArgs</a>(), <a href="../../../docs/manualpages/Sys/PetscGetArguments.html#PetscGetArguments">PetscGetArguments</a>()</font>

<a name="line518">518: </a><font color="#B22222">@*/</font>
<a name="line519">519: </a><strong><font color="#4169E1"><a name="PetscFreeArguments"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscFreeArguments.html#PetscFreeArguments">PetscFreeArguments</a>(char **args)</font></strong>
<a name="line520">520: </a>{
<a name="line521">521: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       i = 0;

<a name="line525">525: </a>  <font color="#4169E1">if</font> (!args) <font color="#4169E1">return</font>(0);
<a name="line526">526: </a>  <font color="#4169E1">while</font> (args[i]) {
<a name="line527">527: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(args[i]);
<a name="line528">528: </a>    i++;
<a name="line529">529: </a>  }
<a name="line530">530: </a>  <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(args);
<a name="line531">531: </a>  <font color="#4169E1">return</font>(0);
<a name="line532">532: </a>}

<a name="line534">534: </a><font color="#A020F0">#if defined(PETSC_HAVE_SAWS)</font>
<a name="line535">535: </a><font color="#A020F0">#include &lt;petscconfiginfo.h&gt;</font>

<a name="line537">537: </a><strong><font color="#4169E1"><a name="PetscInitializeSAWs"></a>PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscInitializeSAWs(const char help[])</font></strong>
<a name="line538">538: </a>{
<a name="line539">539: </a>  <font color="#4169E1">if</font> (!PetscGlobalRank) {
<a name="line540">540: </a>    char           cert[PETSC_MAX_PATH_LEN],root[PETSC_MAX_PATH_LEN],*intro,programname[64],*appline,*options,version[64];
<a name="line541">541: </a>    int            port;
<a name="line542">542: </a>    <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      flg,rootlocal = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>,flg2,selectport = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line543">543: </a>    size_t         applinelen,introlen;
<a name="line545">545: </a>    char           sawsurl[256];

<a name="line547">547: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-saws_log"</font>,&amp;flg);
<a name="line548">548: </a>    <font color="#4169E1">if</font> (flg) {
<a name="line549">549: </a>      char  sawslog[PETSC_MAX_PATH_LEN];

<a name="line551">551: </a>      <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-saws_log"</font>,sawslog,PETSC_MAX_PATH_LEN,NULL);
<a name="line552">552: </a>      <font color="#4169E1">if</font> (sawslog[0]) {
<a name="line553">553: </a>        PetscStackCallSAWs(SAWs_Set_Use_Logfile,(sawslog));
<a name="line554">554: </a>      } <font color="#4169E1">else</font> {
<a name="line555">555: </a>        PetscStackCallSAWs(SAWs_Set_Use_Logfile,(NULL));
<a name="line556">556: </a>      }
<a name="line557">557: </a>    }
<a name="line558">558: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-saws_https"</font>,cert,PETSC_MAX_PATH_LEN,&amp;flg);
<a name="line559">559: </a>    <font color="#4169E1">if</font> (flg) {
<a name="line560">560: </a>      PetscStackCallSAWs(SAWs_Set_Use_HTTPS,(cert));
<a name="line561">561: </a>    }
<a name="line562">562: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-saws_port_auto_select"</font>,&amp;selectport,NULL);
<a name="line563">563: </a>    <font color="#4169E1">if</font> (selectport) {
<a name="line564">564: </a>        PetscStackCallSAWs(SAWs_Get_Available_Port,(&amp;port));
<a name="line565">565: </a>        PetscStackCallSAWs(SAWs_Set_Port,(port));
<a name="line566">566: </a>    } <font color="#4169E1">else</font> {
<a name="line567">567: </a>      <a href="../../../docs/manualpages/Sys/PetscOptionsGetInt.html#PetscOptionsGetInt">PetscOptionsGetInt</a>(NULL,NULL,<font color="#666666">"-saws_port"</font>,&amp;port,&amp;flg);
<a name="line568">568: </a>      <font color="#4169E1">if</font> (flg) {
<a name="line569">569: </a>        PetscStackCallSAWs(SAWs_Set_Port,(port));
<a name="line570">570: </a>      }
<a name="line571">571: </a>    }
<a name="line572">572: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-saws_root"</font>,root,PETSC_MAX_PATH_LEN,&amp;flg);
<a name="line573">573: </a>    <font color="#4169E1">if</font> (flg) {
<a name="line574">574: </a>      PetscStackCallSAWs(SAWs_Set_Document_Root,(root));
<a name="line575">575: </a>      <a href="../../../docs/manualpages/Sys/PetscStrcmp.html#PetscStrcmp">PetscStrcmp</a>(root,<font color="#666666">"."</font>,&amp;rootlocal);
<a name="line576">576: </a>    } <font color="#4169E1">else</font> {
<a name="line577">577: </a>      <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-saws_options"</font>,&amp;flg);
<a name="line578">578: </a>      <font color="#4169E1">if</font> (flg) {
<a name="line579">579: </a>        <a href="../../../docs/manualpages/Sys/PetscStrreplace.html#PetscStrreplace">PetscStrreplace</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"${PETSC_DIR}/share/petsc/saws"</font>,root,PETSC_MAX_PATH_LEN);
<a name="line580">580: </a>        PetscStackCallSAWs(SAWs_Set_Document_Root,(root));
<a name="line581">581: </a>      }
<a name="line582">582: </a>    }
<a name="line583">583: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-saws_local"</font>,&amp;flg2);
<a name="line584">584: </a>    <font color="#4169E1">if</font> (flg2) {
<a name="line585">585: </a>      char jsdir[PETSC_MAX_PATH_LEN];
<a name="line586">586: </a>      <font color="#4169E1">if</font> (!flg) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_SUP,<font color="#666666">"-saws_local option requires -saws_root option"</font>);
<a name="line587">587: </a>      <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(jsdir,PETSC_MAX_PATH_LEN,<font color="#666666">"%s/js"</font>,root);
<a name="line588">588: </a>      <a href="../../../docs/manualpages/Sys/PetscTestDirectory.html#PetscTestDirectory">PetscTestDirectory</a>(jsdir,'r',&amp;flg);
<a name="line589">589: </a>      <font color="#4169E1">if</font> (!flg) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_FILE_READ,<font color="#666666">"-saws_local option requires js directory in root directory"</font>);
<a name="line590">590: </a>      PetscStackCallSAWs(SAWs_Push_Local_Header,());
<a name="line591">591: </a>    }
<a name="line592">592: </a>    <a href="../../../docs/manualpages/Sys/PetscGetProgramName.html#PetscGetProgramName">PetscGetProgramName</a>(programname,64);
<a name="line593">593: </a>    <a href="../../../docs/manualpages/Sys/PetscStrlen.html#PetscStrlen">PetscStrlen</a>(help,&amp;applinelen);
<a name="line594">594: </a>    introlen   = 4096 + applinelen;
<a name="line595">595: </a>    applinelen += 1024;
<a name="line596">596: </a>    <a href="../../../docs/manualpages/Sys/PetscMalloc.html#PetscMalloc">PetscMalloc</a>(applinelen,&amp;appline);
<a name="line597">597: </a>    <a href="../../../docs/manualpages/Sys/PetscMalloc.html#PetscMalloc">PetscMalloc</a>(introlen,&amp;intro);

<a name="line599">599: </a>    <font color="#4169E1">if</font> (rootlocal) {
<a name="line600">600: </a>      <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(appline,applinelen,<font color="#666666">"%s.c.html"</font>,programname);
<a name="line601">601: </a>      <a href="../../../docs/manualpages/Sys/PetscTestFile.html#PetscTestFile">PetscTestFile</a>(appline,'r',&amp;rootlocal);
<a name="line602">602: </a>    }
<a name="line603">603: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetAll.html#PetscOptionsGetAll">PetscOptionsGetAll</a>(NULL,&amp;options);
<a name="line604">604: </a>    <font color="#4169E1">if</font> (rootlocal &amp;&amp; help) {
<a name="line605">605: </a>      <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(appline,applinelen,<font color="#666666">"&lt;center&gt; Running &lt;a href=\"%s.c.html\"&gt;%s&lt;/a&gt; %s&lt;/center&gt;&lt;br&gt;&lt;center&gt;&lt;pre&gt;%s&lt;/pre&gt;&lt;/center&gt;&lt;br&gt;\n"</font>,programname,programname,options,help);
<a name="line606">606: </a>    } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (help) {
<a name="line607">607: </a>      <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(appline,applinelen,<font color="#666666">"&lt;center&gt;Running %s %s&lt;/center&gt;&lt;br&gt;&lt;center&gt;&lt;pre&gt;%s&lt;/pre&gt;&lt;/center&gt;&lt;br&gt;"</font>,programname,options,help);
<a name="line608">608: </a>    } <font color="#4169E1">else</font> {
<a name="line609">609: </a>      <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(appline,applinelen,<font color="#666666">"&lt;center&gt; Running %s %s&lt;/center&gt;&lt;br&gt;\n"</font>,programname,options);
<a name="line610">610: </a>    }
<a name="line611">611: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(options);
<a name="line612">612: </a>    <a href="../../../docs/manualpages/Sys/PetscGetVersion.html#PetscGetVersion">PetscGetVersion</a>(version,<font color="#4169E1">sizeof</font>(version));
<a name="line613">613: </a>    <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(intro,introlen,<font color="#666666">"&lt;body&gt;\n"</font>
<a name="line614">614: </a>                                    <font color="#666666">"&lt;center&gt;&lt;h2&gt; &lt;a href=\"https://www.mcs.anl.gov/petsc\"&gt;PETSc&lt;/a&gt; Application Web server powered by &lt;a href=\"https://bitbucket.org/saws/saws\"&gt;SAWs&lt;/a&gt; &lt;/h2&gt;&lt;/center&gt;\n"</font>
<a name="line615">615: </a>                                    <font color="#666666">"&lt;center&gt;This is the default PETSc application dashboard, from it you can access any published PETSc objects or logging data&lt;/center&gt;&lt;br&gt;&lt;center&gt;%s configured with %s&lt;/center&gt;&lt;br&gt;\n"</font>
<a name="line616">616: </a>                                    <font color="#666666">"%s"</font>,version,petscconfigureoptions,appline);
<a name="line617">617: </a>    PetscStackCallSAWs(SAWs_Push_Body,(<font color="#666666">"index.html"</font>,0,intro));
<a name="line618">618: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(intro);
<a name="line619">619: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(appline);
<a name="line620">620: </a>    <font color="#4169E1">if</font> (selectport) {
<a name="line621">621: </a>      <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> silent;

<a name="line623">623: </a>      SAWs_Initialize();
<a name="line624">624: </a>      <font color="#B22222">/* another process may have grabbed the port so keep trying */</font>
<a name="line625">625: </a>      <font color="#4169E1">while</font> (ierr) {
<a name="line626">626: </a>        PetscStackCallSAWs(SAWs_Get_Available_Port,(&amp;port));
<a name="line627">627: </a>        PetscStackCallSAWs(SAWs_Set_Port,(port));
<a name="line628">628: </a>        SAWs_Initialize();
<a name="line629">629: </a>      }

<a name="line631">631: </a>      <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-saws_port_auto_select_silent"</font>,&amp;silent,NULL);
<a name="line632">632: </a>      <font color="#4169E1">if</font> (!silent) {
<a name="line633">633: </a>        PetscStackCallSAWs(SAWs_Get_FullURL,(<font color="#4169E1">sizeof</font>(sawsurl),sawsurl));
<a name="line634">634: </a>        <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"Point your browser to %s for SAWs\n"</font>,sawsurl);
<a name="line635">635: </a>      }
<a name="line636">636: </a>    } <font color="#4169E1">else</font> {
<a name="line637">637: </a>      PetscStackCallSAWs(SAWs_Initialize,());
<a name="line638">638: </a>    }
<a name="line639">639: </a>    <a href="../../../docs/manualpages/Sys/PetscCitationsRegister.html#PetscCitationsRegister">PetscCitationsRegister</a>(<font color="#666666">"@TechReport{ saws,\n"</font>
<a name="line640">640: </a>                                  <font color="#666666">"  Author = {Matt Otten and Jed Brown and Barry Smith},\n"</font>
<a name="line641">641: </a>                                  <font color="#666666">"  Title  = {Scientific Application Web Server (SAWs) Users Manual},\n"</font>
<a name="line642">642: </a>                                  <font color="#666666">"  Institution = {Argonne National Laboratory},\n"</font>
<a name="line643">643: </a>                                  <font color="#666666">"  Year   = 2013\n}\n"</font>,NULL);
<a name="line644">644: </a>  }
<a name="line645">645: </a>  <font color="#4169E1">return</font>(0);
<a name="line646">646: </a>}
<a name="line647">647: </a><font color="#A020F0">#endif</font>

<a name="line649">649: </a><font color="#B22222">/* Things must be done before <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init.html#MPI_Init">MPI_Init</a>() when MPI is not yet initialized, and can be shared between C init and Fortran init */</font>
<a name="line650">650: </a><strong><font color="#4169E1"><a name="PetscPreMPIInit_Private"></a>PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscPreMPIInit_Private(void)</font></strong>
<a name="line651">651: </a>{
<a name="line653">653: </a><font color="#A020F0">#if defined(PETSC_HAVE_HWLOC_SOLARIS_BUG)</font>
<a name="line654">654: </a>    <font color="#B22222">/* see MPI.py for details on this bug */</font>
<a name="line655">655: </a>    (void) setenv(<font color="#666666">"HWLOC_COMPONENTS"</font>,<font color="#666666">"-x86"</font>,1);
<a name="line656">656: </a><font color="#A020F0">#endif</font>
<a name="line657">657: </a>  <font color="#4169E1">return</font>(0);
<a name="line658">658: </a>}

<a name="line660">660: </a><font color="#A020F0">#if defined(PETSC_HAVE_ADIOS)</font>
<a name="line661">661: </a><font color="#A020F0">#include &lt;adios.h&gt;</font>
<a name="line662">662: </a><font color="#A020F0">#include &lt;adios_read.h&gt;</font>
<a name="line663">663: </a>int64_t Petsc_adios_group;
<a name="line664">664: </a><font color="#A020F0">#endif</font>
<a name="line665">665: </a><font color="#A020F0">#if defined(PETSC_HAVE_ADIOS2)</font>
<a name="line666">666: </a><font color="#A020F0">#include &lt;adios2_c.h&gt;</font>
<a name="line667">667: </a><font color="#A020F0">#endif</font>
<a name="line668">668: </a><font color="#A020F0">#if defined(PETSC_HAVE_OPENMP)</font>
<a name="line669">669: </a><font color="#A020F0">#include &lt;omp.h&gt;</font>
<a name="line670">670: </a><a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> PetscNumOMPThreads;
<a name="line671">671: </a><font color="#A020F0">#endif</font>

<a name="line673">673: </a><font color="#B22222">/*@C</font>
<a name="line674">674: </a><font color="#B22222">   <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a> - Initializes the PETSc database and MPI.</font>
<a name="line675">675: </a><font color="#B22222">   <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() calls <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init.html#MPI_Init">MPI_Init</a>() if that has yet to be called,</font>
<a name="line676">676: </a><font color="#B22222">   so this routine should always be called near the beginning of</font>
<a name="line677">677: </a><font color="#B22222">   your program -- usually the very first line!</font>

<a name="line679">679: </a><font color="#B22222">   Collective on MPI_COMM_WORLD or <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> if it has been set</font>

<a name="line681">681: </a><font color="#B22222">   Input Parameters:</font>
<a name="line682">682: </a><font color="#B22222">+  argc - count of number of command line arguments</font>
<a name="line683">683: </a><font color="#B22222">.  args - the command line arguments</font>
<a name="line684">684: </a><font color="#B22222">.  file - [optional] PETSc database file, also checks ~username/.petscrc and .petscrc use NULL to not check for</font>
<a name="line685">685: </a><font color="#B22222">          code specific file. Use -skip_petscrc in the code specific file to skip the .petscrc files</font>
<a name="line686">686: </a><font color="#B22222">-  help - [optional] Help message to print, use NULL for no message</font>

<a name="line688">688: </a><font color="#B22222">   If you wish PETSc code to run ONLY on a subcommunicator of MPI_COMM_WORLD, create that</font>
<a name="line689">689: </a><font color="#B22222">   communicator first and assign it to <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> BEFORE calling <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(). Thus if you are running a</font>
<a name="line690">690: </a><font color="#B22222">   four process job and two processes will run PETSc and have <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() and <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>() and two process will not,</font>
<a name="line691">691: </a><font color="#B22222">   then do this. If ALL processes in the job are using <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() and <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>() then you don't need to do this, even</font>
<a name="line692">692: </a><font color="#B22222">   if different subcommunicators of the job are doing different things with PETSc.</font>

<a name="line694">694: </a><font color="#B22222">   Options Database Keys:</font>
<a name="line695">695: </a><font color="#B22222">+  -help [intro] - prints help method for each option; if intro is given the program stops after printing the introductory help message</font>
<a name="line696">696: </a><font color="#B22222">.  -start_in_debugger [noxterm,dbx,xdb,gdb,...] - Starts program in debugger</font>
<a name="line697">697: </a><font color="#B22222">.  -on_error_attach_debugger [noxterm,dbx,xdb,gdb,...] - Starts debugger when error detected</font>
<a name="line698">698: </a><font color="#B22222">.  -on_error_emacs &lt;machinename&gt; - causes emacsclient to jump to error file</font>
<a name="line699">699: </a><font color="#B22222">.  -on_error_abort - calls abort() when error detected (no traceback)</font>
<a name="line700">700: </a><font color="#B22222">.  -on_error_mpiabort - calls MPI_abort() when error detected</font>
<a name="line701">701: </a><font color="#B22222">.  -error_output_stderr - prints error messages to stderr instead of the default stdout</font>
<a name="line702">702: </a><font color="#B22222">.  -error_output_none - does not print the error messages (but handles errors in the same way as if this was not called)</font>
<a name="line703">703: </a><font color="#B22222">.  -debugger_nodes [node1,node2,...] - Indicates nodes to start in debugger</font>
<a name="line704">704: </a><font color="#B22222">.  -debugger_pause [sleeptime] (in seconds) - Pauses debugger</font>
<a name="line705">705: </a><font color="#B22222">.  -stop_for_debugger - Print message on how to attach debugger manually to</font>
<a name="line706">706: </a><font color="#B22222">                        process and wait (-debugger_pause) seconds for attachment</font>
<a name="line707">707: </a><font color="#B22222">.  -malloc - Indicates use of PETSc error-checking malloc (on by default for debug version of libraries) (deprecated, use -malloc_debug)</font>
<a name="line708">708: </a><font color="#B22222">.  -malloc no - Indicates not to use error-checking malloc (deprecated, use -malloc_debug no)</font>
<a name="line709">709: </a><font color="#B22222">.  -malloc_debug - check for memory corruption at EVERY malloc or free, see <a href="../../../docs/manualpages/Sys/PetscMallocSetDebug.html#PetscMallocSetDebug">PetscMallocSetDebug</a>()</font>
<a name="line710">710: </a><font color="#B22222">.  -malloc_dump - prints a list of all unfreed memory at the end of the run</font>
<a name="line711">711: </a><font color="#B22222">.  -malloc_test - like -malloc_dump -malloc_debug, but only active for debugging builds, ignored in optimized build. May want to set in PETSC_OPTIONS environmental variable</font>
<a name="line712">712: </a><font color="#B22222">.  -malloc_view - show a list of all allocated memory during <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>()</font>
<a name="line713">713: </a><font color="#B22222">.  -malloc_view_threshold &lt;t&gt; - only list memory allocations of size greater than t with -malloc_view</font>
<a name="line714">714: </a><font color="#B22222">.  -fp_trap - Stops on floating point exceptions</font>
<a name="line715">715: </a><font color="#B22222">.  -no_signal_handler - Indicates not to trap error signals</font>
<a name="line716">716: </a><font color="#B22222">.  -shared_tmp - indicates /tmp directory is shared by all processors</font>
<a name="line717">717: </a><font color="#B22222">.  -not_shared_tmp - each processor has own /tmp</font>
<a name="line718">718: </a><font color="#B22222">.  -tmp - alternative name of /tmp directory</font>
<a name="line719">719: </a><font color="#B22222">.  -get_total_flops - returns total flops done by all processors</font>
<a name="line720">720: </a><font color="#B22222">-  -memory_view - Print memory usage at end of run</font>

<a name="line722">722: </a><font color="#B22222">   Options Database Keys for Profiling:</font>
<a name="line723">723: </a><font color="#B22222">   See Users-Manual: <a href="../../../docs/manualpages/../manual.pdf#chapter.13">Chapter 13 Profiling</a> for details.</font>
<a name="line724">724: </a><font color="#B22222">+  -info &lt;optional filename&gt; - Prints verbose information to the screen</font>
<a name="line725">725: </a><font color="#B22222">.  -info_exclude &lt;null,vec,mat,pc,ksp,snes,ts&gt; - Excludes some of the verbose messages</font>
<a name="line726">726: </a><font color="#B22222">.  -log_sync - Enable barrier synchronization for all events. This option is useful to debug imbalance within each event,</font>
<a name="line727">727: </a><font color="#B22222">        however it slows things down and gives a distorted view of the overall runtime.</font>
<a name="line728">728: </a><font color="#B22222">.  -log_trace [filename] - Print traces of all PETSc calls to the screen (useful to determine where a program</font>
<a name="line729">729: </a><font color="#B22222">        hangs without running in the debugger).  See <a href="../../../docs/manualpages/Profiling/PetscLogTraceBegin.html#PetscLogTraceBegin">PetscLogTraceBegin</a>().</font>
<a name="line730">730: </a><font color="#B22222">.  -log_view [:filename:format] - Prints summary of flop and timing information to screen or file, see <a href="../../../docs/manualpages/Profiling/PetscLogView.html#PetscLogView">PetscLogView</a>().</font>
<a name="line731">731: </a><font color="#B22222">.  -log_view_memory - Includes in the summary from -log_view the memory used in each method, see <a href="../../../docs/manualpages/Profiling/PetscLogView.html#PetscLogView">PetscLogView</a>().</font>
<a name="line732">732: </a><font color="#B22222">.  -log_summary [filename] - (Deprecated, use -log_view) Prints summary of flop and timing information to screen. If the filename is specified the</font>
<a name="line733">733: </a><font color="#B22222">        summary is written to the file.  See <a href="../../../docs/manualpages/Profiling/PetscLogView.html#PetscLogView">PetscLogView</a>().</font>
<a name="line734">734: </a><font color="#B22222">.  -log_exclude: &lt;vec,mat,pc,ksp,snes&gt; - excludes subset of object classes from logging</font>
<a name="line735">735: </a><font color="#B22222">.  -log_all [filename] - Logs extensive profiling information  See <a href="../../../docs/manualpages/Profiling/PetscLogDump.html#PetscLogDump">PetscLogDump</a>().</font>
<a name="line736">736: </a><font color="#B22222">.  -log [filename] - Logs basic profiline information  See <a href="../../../docs/manualpages/Profiling/PetscLogDump.html#PetscLogDump">PetscLogDump</a>().</font>
<a name="line737">737: </a><font color="#B22222">.  -log_mpe [filename] - Creates a logfile viewable by the utility Jumpshot (in MPICH distribution)</font>
<a name="line738">738: </a><font color="#B22222">.  -viewfromoptions on,off - Enable or disable XXXSetFromOptions() calls, for applications with many small solves turn this off</font>
<a name="line739">739: </a><font color="#B22222">-  -check_pointer_intensity 0,1,2 - if pointers are checked for validity (debug version only), using 0 will result in faster code</font>

<a name="line741">741: </a><font color="#B22222">    Only one of -log_trace, -log_view, -log_view, -log_all, -log, or -log_mpe may be used at a time</font>

<a name="line743">743: </a><font color="#B22222">   Options Database Keys for SAWs:</font>
<a name="line744">744: </a><font color="#B22222">+  -saws_port &lt;portnumber&gt; - port number to publish SAWs data, default is 8080</font>
<a name="line745">745: </a><font color="#B22222">.  -saws_port_auto_select - have SAWs select a new unique port number where it publishes the data, the URL is printed to the screen</font>
<a name="line746">746: </a><font color="#B22222">                            this is useful when you are running many jobs that utilize SAWs at the same time</font>
<a name="line747">747: </a><font color="#B22222">.  -saws_log &lt;filename&gt; - save a log of all SAWs communication</font>
<a name="line748">748: </a><font color="#B22222">.  -saws_https &lt;certificate file&gt; - have SAWs use HTTPS instead of HTTP</font>
<a name="line749">749: </a><font color="#B22222">-  -saws_root &lt;directory&gt; - allow SAWs to have access to the given directory to search for requested resources and files</font>

<a name="line751">751: </a><font color="#B22222">   Environmental Variables:</font>
<a name="line752">752: </a><font color="#B22222">+   PETSC_TMP - alternative tmp directory</font>
<a name="line753">753: </a><font color="#B22222">.   PETSC_SHARED_TMP - tmp is shared by all processes</font>
<a name="line754">754: </a><font color="#B22222">.   PETSC_NOT_SHARED_TMP - each process has its own private tmp</font>
<a name="line755">755: </a><font color="#B22222">.   PETSC_VIEWER_SOCKET_PORT - socket number to use for socket viewer</font>
<a name="line756">756: </a><font color="#B22222">-   PETSC_VIEWER_SOCKET_MACHINE - machine to use for socket viewer to connect to</font>


<a name="line759">759: </a><font color="#B22222">   Level: beginner</font>

<a name="line761">761: </a><font color="#B22222">   Notes:</font>
<a name="line762">762: </a><font color="#B22222">   If for some reason you must call <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init.html#MPI_Init">MPI_Init</a>() separately, call</font>
<a name="line763">763: </a><font color="#B22222">   it before <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>().</font>

<a name="line765">765: </a><font color="#B22222">   Fortran Version:</font>
<a name="line766">766: </a><font color="#B22222">   In Fortran this routine has the format</font>
<a name="line767">767: </a><font color="#B22222">$       call <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(file,ierr)</font>

<a name="line769">769: </a><font color="#B22222">+   ierr - error return code</font>
<a name="line770">770: </a><font color="#B22222">-  file - [optional] PETSc database file, also checks ~username/.petscrc and .petscrc use PETSC_NULL_CHARACTER to not check for</font>
<a name="line771">771: </a><font color="#B22222">          code specific file. Use -skip_petscrc in the code specific file to skip the .petscrc files</font>

<a name="line773">773: </a><font color="#B22222">   Important Fortran Note:</font>
<a name="line774">774: </a><font color="#B22222">   In Fortran, you MUST use PETSC_NULL_CHARACTER to indicate a</font>
<a name="line775">775: </a><font color="#B22222">   null character string; you CANNOT just use NULL as</font>
<a name="line776">776: </a><font color="#B22222">   in the C version. See Users-Manual: <a href="../../../docs/manualpages/../manual.pdf#chapter.11">Chapter 11 PETSc for Fortran Users</a> for details.</font>

<a name="line778">778: </a><font color="#B22222">   If your main program is C but you call Fortran code that also uses PETSc you need to call <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>() soon after</font>
<a name="line779">779: </a><font color="#B22222">   calling <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>().</font>

<a name="line781">781: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>(), <a href="../../../docs/manualpages/Sys/PetscGetArgs.html#PetscGetArgs">PetscGetArgs</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeNoArguments.html#PetscInitializeNoArguments">PetscInitializeNoArguments</a>()</font>

<a name="line783">783: </a><font color="#B22222">@*/</font>
<a name="line784">784: </a><strong><font color="#4169E1"><a name="PetscInitialize"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(int *argc,char ***args,const char file[],const char help[])</font></strong>
<a name="line785">785: </a>{
<a name="line787">787: </a>  <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>    flag, size;
<a name="line788">788: </a>  <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      flg = <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line789">789: </a>  char           hostname[256];

<a name="line792">792: </a>  <font color="#4169E1">if</font> (PetscInitializeCalled) <font color="#4169E1">return</font>(0);
<a name="line793">793: </a>  <font color="#B22222">/*</font>
<a name="line794">794: </a><font color="#B22222">      The checking over compatible runtime libraries is complicated by the MPI ABI initiative</font>
<a name="line795">795: </a><font color="#B22222">      https://wiki.mpich.org/mpich/index.php/ABI_Compatibility_Initiative which started with</font>
<a name="line796">796: </a><font color="#B22222">        MPICH v3.1 (Released Feburary 2014)</font>
<a name="line797">797: </a><font color="#B22222">        IBM MPI v2.1 (December 2014)</font>
<a name="line798">798: </a><font color="#B22222">        Intel&Acirc; MPI Library v5.0 (2014)</font>
<a name="line799">799: </a><font color="#B22222">        Cray MPT v7.0.0 (June 2014)</font>
<a name="line800">800: </a><font color="#B22222">      As of July 31, 2017 the ABI number still appears to be 12, that is all of the versions</font>
<a name="line801">801: </a><font color="#B22222">      listed above and since that time are compatible.</font>

<a name="line803">803: </a><font color="#B22222">      Unfortunately the MPI ABI initiative has not defined a way to determine the ABI number</font>
<a name="line804">804: </a><font color="#B22222">      at compile time or runtime. Thus we will need to systematically track the allowed versions</font>
<a name="line805">805: </a><font color="#B22222">      and how they are represented in the mpi.h and <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Get_library_version.html#MPI_Get_library_version">MPI_Get_library_version</a>() output in order</font>
<a name="line806">806: </a><font color="#B22222">      to perform the checking.</font>

<a name="line808">808: </a><font color="#B22222">      Currently we only check for pre MPI ABI versions (and packages that do not follow the MPI ABI).</font>

<a name="line810">810: </a><font color="#B22222">      Questions:</font>

<a name="line812">812: </a><font color="#B22222">        Should the checks for ABI incompatibility be only on the major version number below?</font>
<a name="line813">813: </a><font color="#B22222">        Presumably the output to stderr will be removed before a release.</font>
<a name="line814">814: </a><font color="#B22222">  */</font>

<a name="line816">816: </a><font color="#A020F0">#if defined(PETSC_HAVE_MPI_GET_LIBRARY_VERSION)</font>
<a name="line817">817: </a>  {
<a name="line818">818: </a>    char        mpilibraryversion[MPI_MAX_LIBRARY_VERSION_STRING];
<a name="line819">819: </a>    <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> mpilibraryversionlength;
<a name="line820">820: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Get_library_version.html#MPI_Get_library_version">MPI_Get_library_version</a>(mpilibraryversion,&amp;mpilibraryversionlength);<font color="#4169E1">if</font> (ierr) <font color="#4169E1">return</font> ierr;
<a name="line821">821: </a>    <font color="#B22222">/* check for MPICH versions before MPI ABI initiative */</font>
<a name="line822">822: </a><font color="#A020F0">#if defined(MPICH_VERSION)</font>
<a name="line823">823: </a><font color="#A020F0">#if MPICH_NUMVERSION &lt; 30100000</font>
<a name="line824">824: </a>    {
<a name="line825">825: </a>      char *ver,*lf;
<a name="line826">826: </a>      flg = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line827">827: </a>      <a href="../../../docs/manualpages/Sys/PetscStrstr.html#PetscStrstr">PetscStrstr</a>(mpilibraryversion,<font color="#666666">"MPICH Version:"</font>,&amp;ver);<font color="#4169E1">if</font> (ierr) <font color="#4169E1">return</font> ierr;
<a name="line828">828: </a>      <font color="#4169E1">if</font> (ver) {
<a name="line829">829: </a>        <a href="../../../docs/manualpages/Sys/PetscStrchr.html#PetscStrchr">PetscStrchr</a>(ver,'\n',&amp;lf);<font color="#4169E1">if</font> (ierr) <font color="#4169E1">return</font> ierr;
<a name="line830">830: </a>        <font color="#4169E1">if</font> (lf) {
<a name="line831">831: </a>          *lf = 0;
<a name="line832">832: </a>          <a href="../../../docs/manualpages/Sys/PetscStrendswith.html#PetscStrendswith">PetscStrendswith</a>(ver,MPICH_VERSION,&amp;flg);<font color="#4169E1">if</font> (ierr) <font color="#4169E1">return</font> ierr;
<a name="line833">833: </a>        }
<a name="line834">834: </a>      }
<a name="line835">835: </a>      <font color="#4169E1">if</font> (!flg) {
<a name="line836">836: </a>        fprintf(stderr,<font color="#666666">"PETSc Error --- MPICH library version \n%s does not match what PETSc was compiled with %s, aborting\n"</font>,mpilibraryversion,MPICH_VERSION);
<a name="line837">837: </a>        <font color="#4169E1">return</font> PETSC_ERR_MPI_LIB_INCOMP;
<a name="line838">838: </a>      }
<a name="line839">839: </a>    }
<a name="line840">840: </a><font color="#A020F0">#endif</font>
<a name="line841">841: </a>    <font color="#B22222">/* check for OpenMPI version, it is not part of the MPI ABI initiative (is it part of another initiative that needs to be handled?) */</font>
<a name="line842">842: </a><font color="#A020F0">#elif defined(OMPI_MAJOR_VERSION)</font>
<a name="line843">843: </a>    {
<a name="line844">844: </a>      char *ver,bs[32],*bsf;
<a name="line845">845: </a>      flg = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line846">846: </a>      <a href="../../../docs/manualpages/Sys/PetscStrstr.html#PetscStrstr">PetscStrstr</a>(mpilibraryversion,<font color="#666666">"Open MPI"</font>,&amp;ver);<font color="#4169E1">if</font> (ierr) <font color="#4169E1">return</font> ierr;
<a name="line847">847: </a>      <font color="#4169E1">if</font> (ver) {
<a name="line848">848: </a>        <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(bs,32,<font color="#666666">"v%d.%d"</font>,OMPI_MAJOR_VERSION,OMPI_MINOR_VERSION);
<a name="line849">849: </a>        <a href="../../../docs/manualpages/Sys/PetscStrstr.html#PetscStrstr">PetscStrstr</a>(ver,bs,&amp;bsf);<font color="#4169E1">if</font> (ierr) <font color="#4169E1">return</font> ierr;
<a name="line850">850: </a>        <font color="#4169E1">if</font> (bsf) flg = <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line851">851: </a>      }
<a name="line852">852: </a>      <font color="#4169E1">if</font> (!flg) {
<a name="line853">853: </a>        fprintf(stderr,<font color="#666666">"PETSc Error --- Open MPI library version \n%s does not match what PETSc was compiled with %d.%d, aborting\n"</font>,mpilibraryversion,OMPI_MAJOR_VERSION,OMPI_MINOR_VERSION);
<a name="line854">854: </a>        <font color="#4169E1">return</font> PETSC_ERR_MPI_LIB_INCOMP;
<a name="line855">855: </a>      }
<a name="line856">856: </a>    }
<a name="line857">857: </a><font color="#A020F0">#endif</font>
<a name="line858">858: </a>  }
<a name="line859">859: </a><font color="#A020F0">#endif</font>

<a name="line861">861: </a>  <font color="#B22222">/* these must be initialized in a routine, not as a constant declaration*/</font>
<a name="line862">862: </a>  PETSC_STDOUT = stdout;
<a name="line863">863: </a>  PETSC_STDERR = stderr;

<a name="line865">865: </a>  <font color="#B22222">/* on Windows - set printf to default to printing 2 digit exponents */</font>
<a name="line866">866: </a><font color="#A020F0">#if defined(PETSC_HAVE__SET_OUTPUT_FORMAT)</font>
<a name="line867">867: </a>  _set_output_format(_TWO_DIGIT_EXPONENT);
<a name="line868">868: </a><font color="#A020F0">#endif</font>

<a name="line870">870: </a>  PetscOptionsCreateDefault();

<a name="line872">872: </a>  <font color="#B22222">/*</font>
<a name="line873">873: </a><font color="#B22222">     We initialize the program name here (before <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init.html#MPI_Init">MPI_Init</a>()) because MPICH has a bug in</font>
<a name="line874">874: </a><font color="#B22222">     it that it sets args[0] on all processors to be args[0] on the first processor.</font>
<a name="line875">875: </a><font color="#B22222">  */</font>
<a name="line876">876: </a>  <font color="#4169E1">if</font> (argc &amp;&amp; *argc) {
<a name="line877">877: </a>    PetscSetProgramName(**args);
<a name="line878">878: </a>  } <font color="#4169E1">else</font> {
<a name="line879">879: </a>    PetscSetProgramName(<font color="#666666">"Unknown Name"</font>);
<a name="line880">880: </a>  }

<a name="line882">882: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Initialized.html#MPI_Initialized">MPI_Initialized</a>(&amp;flag);
<a name="line883">883: </a>  <font color="#4169E1">if</font> (!flag) {
<a name="line884">884: </a>    <font color="#4169E1">if</font> (<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> != MPI_COMM_NULL) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_SUP,<font color="#666666">"You cannot set <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> if you have not initialized MPI first"</font>);
<a name="line885">885: </a>    PetscPreMPIInit_Private();
<a name="line886">886: </a><font color="#A020F0">#if defined(PETSC_HAVE_MPI_INIT_THREAD)</font>
<a name="line887">887: </a>    {
<a name="line888">888: </a>      <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> provided;
<a name="line889">889: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init_thread.html#MPI_Init_thread">MPI_Init_thread</a>(argc,args,MPI_THREAD_FUNNELED,&amp;provided);
<a name="line890">890: </a>    }
<a name="line891">891: </a><font color="#A020F0">#else</font>
<a name="line892">892: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init.html#MPI_Init">MPI_Init</a>(argc,args);
<a name="line893">893: </a><font color="#A020F0">#endif</font>
<a name="line894">894: </a>    PetscBeganMPI = <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line895">895: </a>  }

<a name="line897">897: </a>  <font color="#4169E1">if</font> (argc &amp;&amp; args) {
<a name="line898">898: </a>    PetscGlobalArgc = *argc;
<a name="line899">899: </a>    PetscGlobalArgs = *args;
<a name="line900">900: </a>  }
<a name="line901">901: </a>  PetscFinalizeCalled = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line902">902: </a>  PetscSpinlockCreate(&amp;PetscViewerASCIISpinLockOpen);
<a name="line903">903: </a>  PetscSpinlockCreate(&amp;PetscViewerASCIISpinLockStdout);
<a name="line904">904: </a>  PetscSpinlockCreate(&amp;PetscViewerASCIISpinLockStderr);
<a name="line905">905: </a>  PetscSpinlockCreate(&amp;PetscCommSpinLock);

<a name="line907">907: </a>  <font color="#4169E1">if</font> (<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> == MPI_COMM_NULL) <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> = MPI_COMM_WORLD;
<a name="line908">908: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_set_errhandler.html#MPI_Comm_set_errhandler">MPI_Comm_set_errhandler</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,MPI_ERRORS_RETURN);

<a name="line910">910: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Add_error_class.html#MPI_Add_error_class">MPI_Add_error_class</a>(&amp;PETSC_MPI_ERROR_CLASS);
<a name="line911">911: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Add_error_code.html#MPI_Add_error_code">MPI_Add_error_code</a>(PETSC_MPI_ERROR_CLASS,&amp;PETSC_MPI_ERROR_CODE);

<a name="line913">913: </a>  <font color="#B22222">/* Done after init due to a bug in MPICH-GM? */</font>
<a name="line914">914: </a>  PetscErrorPrintfInitialize();

<a name="line916">916: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_rank.html#MPI_Comm_rank">MPI_Comm_rank</a>(MPI_COMM_WORLD,&amp;PetscGlobalRank);
<a name="line917">917: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_size.html#MPI_Comm_size">MPI_Comm_size</a>(MPI_COMM_WORLD,&amp;PetscGlobalSize);

<a name="line919">919: </a>  MPIU_BOOL = MPI_INT;
<a name="line920">920: </a>  MPIU_ENUM = MPI_INT;
<a name="line921">921: </a>  MPIU_FORTRANADDR = (<font color="#4169E1">sizeof</font>(void*) == <font color="#4169E1">sizeof</font>(int)) ? MPI_INT : MPIU_INT64;
<a name="line922">922: </a>  <font color="#4169E1">if</font> (<font color="#4169E1">sizeof</font>(size_t) == <font color="#4169E1">sizeof</font>(unsigned)) MPIU_SIZE_T = MPI_UNSIGNED;
<a name="line923">923: </a>  <font color="#4169E1">else</font> <font color="#4169E1">if</font> (<font color="#4169E1">sizeof</font>(size_t) == <font color="#4169E1">sizeof</font>(unsigned long)) MPIU_SIZE_T = MPI_UNSIGNED_LONG;
<a name="line924">924: </a><font color="#A020F0">#if defined(PETSC_SIZEOF_LONG_LONG)</font>
<a name="line925">925: </a>  <font color="#4169E1">else</font> <font color="#4169E1">if</font> (<font color="#4169E1">sizeof</font>(size_t) == <font color="#4169E1">sizeof</font>(unsigned long long)) MPIU_SIZE_T = MPI_UNSIGNED_LONG_LONG;
<a name="line926">926: </a><font color="#A020F0">#endif</font>
<a name="line927">927: </a>  <font color="#4169E1">else</font> {(*<a href="../../../docs/manualpages/Sys/PetscErrorPrintf.html#PetscErrorPrintf">PetscErrorPrintf</a>)(<font color="#666666">"<a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>: Could not find MPI type for size_t\n"</font>); <font color="#4169E1">return</font> PETSC_ERR_SUP_SYS;}

<a name="line929">929: </a>  <font color="#B22222">/*</font>
<a name="line930">930: </a><font color="#B22222">     Initialized the global complex variable; this is because with</font>
<a name="line931">931: </a><font color="#B22222">     shared libraries the constructors for global variables</font>
<a name="line932">932: </a><font color="#B22222">     are not called; at least on IRIX.</font>
<a name="line933">933: </a><font color="#B22222">  */</font>
<a name="line934">934: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line935">935: </a>  {
<a name="line936">936: </a><font color="#A020F0">#if defined(PETSC_CLANGUAGE_CXX) &amp;&amp; !defined(PETSC_USE_REAL___FLOAT128)</font>
<a name="line937">937: </a>    <a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a> ic(0.0,1.0);
<a name="line938">938: </a>    <a href="../../../docs/manualpages/Sys/PETSC_i.html#PETSC_i">PETSC_i</a> = ic;
<a name="line939">939: </a><font color="#A020F0">#else</font>
<a name="line940">940: </a>    <a href="../../../docs/manualpages/Sys/PETSC_i.html#PETSC_i">PETSC_i</a> = _Complex_I;
<a name="line941">941: </a><font color="#A020F0">#endif</font>
<a name="line942">942: </a>  }

<a name="line944">944: </a><font color="#A020F0">#if !defined(PETSC_HAVE_MPI_C_DOUBLE_COMPLEX)</font>
<a name="line945">945: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_contiguous.html#MPI_Type_contiguous">MPI_Type_contiguous</a>(2,MPI_DOUBLE,&amp;MPIU_C_DOUBLE_COMPLEX);
<a name="line946">946: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_commit.html#MPI_Type_commit">MPI_Type_commit</a>(&amp;MPIU_C_DOUBLE_COMPLEX);
<a name="line947">947: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_contiguous.html#MPI_Type_contiguous">MPI_Type_contiguous</a>(2,MPI_FLOAT,&amp;MPIU_C_COMPLEX);
<a name="line948">948: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_commit.html#MPI_Type_commit">MPI_Type_commit</a>(&amp;MPIU_C_COMPLEX);
<a name="line949">949: </a><font color="#A020F0">#endif</font>
<a name="line950">950: </a><font color="#A020F0">#endif </font><font color="#B22222">/* PETSC_HAVE_COMPLEX */</font><font color="#A020F0"></font>

<a name="line952">952: </a>  <font color="#B22222">/*</font>
<a name="line953">953: </a><font color="#B22222">     Create the PETSc MPI reduction operator that sums of the first</font>
<a name="line954">954: </a><font color="#B22222">     half of the entries and maxes the second half.</font>
<a name="line955">955: </a><font color="#B22222">  */</font>
<a name="line956">956: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_create.html#MPI_Op_create">MPI_Op_create</a>(MPIU_MaxSum_Local,1,&amp;MPIU_MAXSUM_OP);

<a name="line958">958: </a><font color="#A020F0">#if defined(PETSC_USE_REAL___FLOAT128)</font>
<a name="line959">959: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_contiguous.html#MPI_Type_contiguous">MPI_Type_contiguous</a>(2,MPI_DOUBLE,&amp;MPIU___FLOAT128);
<a name="line960">960: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_commit.html#MPI_Type_commit">MPI_Type_commit</a>(&amp;MPIU___FLOAT128);
<a name="line961">961: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line962">962: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_contiguous.html#MPI_Type_contiguous">MPI_Type_contiguous</a>(4,MPI_DOUBLE,&amp;MPIU___COMPLEX128);
<a name="line963">963: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_commit.html#MPI_Type_commit">MPI_Type_commit</a>(&amp;MPIU___COMPLEX128);
<a name="line964">964: </a><font color="#A020F0">#endif</font>
<a name="line965">965: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_create.html#MPI_Op_create">MPI_Op_create</a>(PetscMax_Local,1,&amp;MPIU_MAX);
<a name="line966">966: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_create.html#MPI_Op_create">MPI_Op_create</a>(PetscMin_Local,1,&amp;MPIU_MIN);
<a name="line967">967: </a><font color="#A020F0">#elif defined(PETSC_USE_REAL___FP16)</font>
<a name="line968">968: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_contiguous.html#MPI_Type_contiguous">MPI_Type_contiguous</a>(2,MPI_CHAR,&amp;MPIU___FP16);
<a name="line969">969: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_commit.html#MPI_Type_commit">MPI_Type_commit</a>(&amp;MPIU___FP16);
<a name="line970">970: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_create.html#MPI_Op_create">MPI_Op_create</a>(PetscMax_Local,1,&amp;MPIU_MAX);
<a name="line971">971: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_create.html#MPI_Op_create">MPI_Op_create</a>(PetscMin_Local,1,&amp;MPIU_MIN);
<a name="line972">972: </a><font color="#A020F0">#endif</font>

<a name="line974">974: </a><font color="#A020F0">#if (defined(PETSC_HAVE_COMPLEX) &amp;&amp; !defined(PETSC_HAVE_MPI_C_DOUBLE_COMPLEX)) || defined(PETSC_USE_REAL___FLOAT128) || defined(PETSC_USE_REAL___FP16)</font>
<a name="line975">975: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_create.html#MPI_Op_create">MPI_Op_create</a>(PetscSum_Local,1,&amp;MPIU_SUM);
<a name="line976">976: </a><font color="#A020F0">#endif</font>

<a name="line978">978: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_contiguous.html#MPI_Type_contiguous">MPI_Type_contiguous</a>(2,<a href="../../../docs/manualpages/Sys/MPIU_SCALAR.html#MPIU_SCALAR">MPIU_SCALAR</a>,&amp;MPIU_2SCALAR);
<a name="line979">979: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_commit.html#MPI_Type_commit">MPI_Type_commit</a>(&amp;MPIU_2SCALAR);

<a name="line981">981: </a><font color="#A020F0">#if defined(PETSC_USE_64BIT_INDICES)</font>
<a name="line982">982: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_contiguous.html#MPI_Type_contiguous">MPI_Type_contiguous</a>(2,<a href="../../../docs/manualpages/Sys/MPIU_INT.html#MPIU_INT">MPIU_INT</a>,&amp;MPIU_2INT);
<a name="line983">983: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_commit.html#MPI_Type_commit">MPI_Type_commit</a>(&amp;MPIU_2INT);
<a name="line984">984: </a><font color="#A020F0">#endif</font>


<a name="line987">987: </a>  <font color="#B22222">/*</font>
<a name="line988">988: </a><font color="#B22222">     Attributes to be set on PETSc communicators</font>
<a name="line989">989: </a><font color="#B22222">  */</font>
<a name="line990">990: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_create_keyval.html#MPI_Comm_create_keyval">MPI_Comm_create_keyval</a>(MPI_COMM_NULL_COPY_FN,Petsc_DelCounter,&amp;Petsc_Counter_keyval,(void*)0);
<a name="line991">991: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_create_keyval.html#MPI_Comm_create_keyval">MPI_Comm_create_keyval</a>(MPI_COMM_NULL_COPY_FN,Petsc_DelComm_Outer,&amp;Petsc_InnerComm_keyval,(void*)0);
<a name="line992">992: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_create_keyval.html#MPI_Comm_create_keyval">MPI_Comm_create_keyval</a>(MPI_COMM_NULL_COPY_FN,Petsc_DelComm_Inner,&amp;Petsc_OuterComm_keyval,(void*)0);
<a name="line993">993: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_create_keyval.html#MPI_Comm_create_keyval">MPI_Comm_create_keyval</a>(MPI_COMM_NULL_COPY_FN,Petsc_DelComm_Shm,&amp;Petsc_ShmComm_keyval,(void*)0);

<a name="line995">995: </a>  <font color="#B22222">/*</font>
<a name="line996">996: </a><font color="#B22222">     Build the options database</font>
<a name="line997">997: </a><font color="#B22222">  */</font>
<a name="line998">998: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsInsert.html#PetscOptionsInsert">PetscOptionsInsert</a>(NULL,argc,args,file);

<a name="line1000">1000: </a>  <font color="#B22222">/* call a second time so it can look in the options database */</font>
<a name="line1001">1001: </a>  PetscErrorPrintfInitialize();

<a name="line1003">1003: </a>  <font color="#B22222">/*</font>
<a name="line1004">1004: </a><font color="#B22222">     Print main application help message</font>
<a name="line1005">1005: </a><font color="#B22222">  */</font>
<a name="line1006">1006: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasHelp.html#PetscOptionsHasHelp">PetscOptionsHasHelp</a>(NULL,&amp;flg);
<a name="line1007">1007: </a>  <font color="#4169E1">if</font> (help &amp;&amp; flg) {
<a name="line1008">1008: </a>    <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,help);
<a name="line1009">1009: </a>  }
<a name="line1010">1010: </a>  PetscOptionsCheckInitial_Private();

<a name="line1012">1012: </a>  PetscCitationsInitialize();

<a name="line1014">1014: </a><font color="#A020F0">#if defined(PETSC_HAVE_SAWS)</font>
<a name="line1015">1015: </a>  PetscInitializeSAWs(help);
<a name="line1016">1016: </a><font color="#A020F0">#endif</font>

<a name="line1018">1018: </a>  <font color="#B22222">/*</font>
<a name="line1019">1019: </a><font color="#B22222">     Load the dynamic libraries (on machines that support them), this registers all</font>
<a name="line1020">1020: </a><font color="#B22222">     the solvers etc. (On non-dynamic machines this initializes the <a href="../../../docs/manualpages/Draw/PetscDraw.html#PetscDraw">PetscDraw</a> and <a href="../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> classes)</font>
<a name="line1021">1021: </a><font color="#B22222">  */</font>
<a name="line1022">1022: </a>  PetscInitialize_DynamicLibraries();

<a name="line1024">1024: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_size.html#MPI_Comm_size">MPI_Comm_size</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,&amp;size);
<a name="line1025">1025: </a>  PetscInfo1(0,<font color="#666666">"PETSc successfully started: number of processors = %d\n"</font>,size);
<a name="line1026">1026: </a>  <a href="../../../docs/manualpages/Sys/PetscGetHostName.html#PetscGetHostName">PetscGetHostName</a>(hostname,256);
<a name="line1027">1027: </a>  PetscInfo1(0,<font color="#666666">"Running on machine: %s\n"</font>,hostname);
<a name="line1028">1028: </a><font color="#A020F0">#if defined(PETSC_HAVE_OPENMP)</font>
<a name="line1029">1029: </a>  {
<a name="line1030">1030: </a>    <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> omp_view_flag;
<a name="line1031">1031: </a>    char      *threads = getenv(<font color="#666666">"OMP_NUM_THREADS"</font>);

<a name="line1033">1033: </a>   <font color="#4169E1">if</font> (threads) {
<a name="line1034">1034: </a>     PetscInfo1(0,<font color="#666666">"Number of OpenMP threads %s (given by OMP_NUM_THREADS)\n"</font>,threads);
<a name="line1035">1035: </a>     (void) sscanf(threads, <font color="#666666">"%"</font> PetscInt_FMT,&amp;PetscNumOMPThreads);
<a name="line1036">1036: </a>   } <font color="#4169E1">else</font> {
<a name="line1037">1037: </a><strong><font color="#228B22">#define NMAX  10000</font></strong>
<a name="line1038">1038: </a>     int          i;
<a name="line1039">1039: </a>      <a href="../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *x;
<a name="line1040">1040: </a>      <a href="../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(NMAX,&amp;x);
<a name="line1041">1041: </a><font color="#A020F0">#pragma omp parallel for</font>
<a name="line1042">1042: </a>      <font color="#4169E1">for</font> (i=0; i&lt;NMAX; i++) {
<a name="line1043">1043: </a>        x[i] = 0.0;
<a name="line1044">1044: </a>        PetscNumOMPThreads  = (<a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>) omp_get_num_threads();
<a name="line1045">1045: </a>      }
<a name="line1046">1046: </a>      <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(x);
<a name="line1047">1047: </a>      PetscInfo1(0,<font color="#666666">"Number of OpenMP threads %D (number not set with OMP_NUM_THREADS, chosen by system)\n"</font>,PetscNumOMPThreads);
<a name="line1048">1048: </a>    }
<a name="line1049">1049: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsBegin.html#PetscOptionsBegin">PetscOptionsBegin</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,NULL,<font color="#666666">"OpenMP options"</font>,<font color="#666666">"Sys"</font>);
<a name="line1050">1050: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsInt.html#PetscOptionsInt">PetscOptionsInt</a>(<font color="#666666">"-omp_num_threads"</font>,<font color="#666666">"Number of OpenMP threads to use (can also use environmental variable OMP_NUM_THREADS"</font>,<font color="#666666">"None"</font>,PetscNumOMPThreads,&amp;PetscNumOMPThreads,&amp;flg);
<a name="line1051">1051: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsName.html#PetscOptionsName">PetscOptionsName</a>(<font color="#666666">"-omp_view"</font>,<font color="#666666">"Display OpenMP number of threads"</font>,NULL,&amp;omp_view_flag);
<a name="line1052">1052: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsEnd.html#PetscOptionsEnd">PetscOptionsEnd</a>();
<a name="line1053">1053: </a>    <font color="#4169E1">if</font> (flg) {
<a name="line1054">1054: </a>      PetscInfo1(0,<font color="#666666">"Number of OpenMP theads %D (given by -omp_num_threads)\n"</font>,PetscNumOMPThreads);
<a name="line1055">1055: </a>      omp_set_num_threads((int)PetscNumOMPThreads);
<a name="line1056">1056: </a>    }
<a name="line1057">1057: </a>    <font color="#4169E1">if</font> (omp_view_flag) {
<a name="line1058">1058: </a>      <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"OpenMP: number of threads %D\n"</font>,PetscNumOMPThreads);
<a name="line1059">1059: </a>    }
<a name="line1060">1060: </a>  }
<a name="line1061">1061: </a><font color="#A020F0">#endif</font>
<a name="line1062">1062: </a>  PetscOptionsCheckInitial_Components();
<a name="line1063">1063: </a>  <font color="#B22222">/* Check the options database for options related to the options database itself */</font>
<a name="line1064">1064: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsSetFromOptions.html#PetscOptionsSetFromOptions">PetscOptionsSetFromOptions</a>(NULL);

<a name="line1066">1066: </a><font color="#A020F0">#if defined(PETSC_USE_PETSC_MPI_EXTERNAL32)</font>
<a name="line1067">1067: </a>  <font color="#B22222">/*</font>
<a name="line1068">1068: </a><font color="#B22222">      Tell MPI about our own data representation converter, this would/should be used if extern32 is not supported by the MPI</font>

<a name="line1070">1070: </a><font color="#B22222">      Currently not used because it is not supported by MPICH.</font>
<a name="line1071">1071: </a><font color="#B22222">  */</font>
<a name="line1072">1072: </a>  <font color="#4169E1">if</font> (!PetscBinaryBigEndian()) {
<a name="line1073">1073: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Register_datarep.html#MPI_Register_datarep">MPI_Register_datarep</a>((char*)<font color="#666666">"petsc"</font>,PetscDataRep_read_conv_fn,PetscDataRep_write_conv_fn,PetscDataRep_extent_fn,NULL);
<a name="line1074">1074: </a>  }
<a name="line1075">1075: </a><font color="#A020F0">#endif</font>

<a name="line1077">1077: </a>  <font color="#B22222">/*</font>
<a name="line1078">1078: </a><font color="#B22222">      Setup building of stack frames for all function calls</font>
<a name="line1079">1079: </a><font color="#B22222">  */</font>
<a name="line1080">1080: </a><font color="#A020F0">#if defined(PETSC_USE_DEBUG) &amp;&amp; !defined(PETSC_HAVE_THREADSAFETY)</font>
<a name="line1081">1081: </a>  PetscStackCreate();
<a name="line1082">1082: </a><font color="#A020F0">#endif</font>

<a name="line1084">1084: </a><font color="#A020F0">#if defined(PETSC_SERIALIZE_FUNCTIONS)</font>
<a name="line1085">1085: </a>  PetscFPTCreate(10000);
<a name="line1086">1086: </a><font color="#A020F0">#endif</font>

<a name="line1088">1088: </a><font color="#A020F0">#if defined(PETSC_HAVE_HWLOC)</font>
<a name="line1089">1089: </a>  {
<a name="line1090">1090: </a>    <a href="../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> viewer;
<a name="line1091">1091: </a>    <a href="../../../docs/manualpages/Viewer/PetscOptionsGetViewer.html#PetscOptionsGetViewer">PetscOptionsGetViewer</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,NULL,NULL,<font color="#666666">"-process_view"</font>,&amp;viewer,NULL,&amp;flg);
<a name="line1092">1092: </a>    <font color="#4169E1">if</font> (flg) {
<a name="line1093">1093: </a>      <a href="../../../docs/manualpages/Sys/PetscProcessPlacementView.html#PetscProcessPlacementView">PetscProcessPlacementView</a>(viewer);
<a name="line1094">1094: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerDestroy.html#PetscViewerDestroy">PetscViewerDestroy</a>(&amp;viewer);
<a name="line1095">1095: </a>    }
<a name="line1096">1096: </a>  }
<a name="line1097">1097: </a><font color="#A020F0">#endif</font>

<a name="line1099">1099: </a>  flg = <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1100">1100: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-viewfromoptions"</font>,&amp;flg,NULL);
<a name="line1101">1101: </a>  <font color="#4169E1">if</font> (!flg) {<a href="../../../docs/manualpages/Viewer/PetscOptionsPushGetViewerOff.html#PetscOptionsPushGetViewerOff">PetscOptionsPushGetViewerOff</a>(<a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>); }

<a name="line1103">1103: </a><font color="#A020F0">#if defined(PETSC_HAVE_ADIOS)</font>
<a name="line1104">1104: </a>  adios_init_noxml(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>);
<a name="line1105">1105: </a>  adios_declare_group(&amp;Petsc_adios_group,<font color="#666666">"PETSc"</font>,<font color="#666666">""</font>,adios_stat_default);
<a name="line1106">1106: </a>  adios_select_method(Petsc_adios_group,<font color="#666666">"MPI"</font>,<font color="#666666">""</font>,<font color="#666666">""</font>);
<a name="line1107">1107: </a>  adios_read_init_method(ADIOS_READ_METHOD_BP,<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">""</font>);
<a name="line1108">1108: </a><font color="#A020F0">#endif</font>
<a name="line1109">1109: </a><font color="#A020F0">#if defined(PETSC_HAVE_ADIOS2)</font>
<a name="line1110">1110: </a><font color="#A020F0">#endif</font>

<a name="line1112">1112: </a>  <font color="#B22222">/*</font>
<a name="line1113">1113: </a><font color="#B22222">      Once we are completedly initialized then we can set this variables</font>
<a name="line1114">1114: </a><font color="#B22222">  */</font>
<a name="line1115">1115: </a>  PetscInitializeCalled = <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;

<a name="line1117">1117: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-python"</font>,&amp;flg);
<a name="line1118">1118: </a>  <font color="#4169E1">if</font> (flg) {PetscPythonInitialize(NULL,NULL);}

<a name="line1120">1120: </a><font color="#A020F0">#if defined(PETSC_HAVE_CUDA)</font>
<a name="line1121">1121: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-use_gpu_aware_mpi"</font>,&amp;use_gpu_aware_mpi,NULL);
<a name="line1122">1122: </a><font color="#A020F0">#if defined(PETSC_HAVE_OPENMPI_MAJOR) &amp;&amp; defined(MPIX_CUDA_AWARE_SUPPORT)</font>
<a name="line1123">1123: </a>  <font color="#B22222">/* OpenMPI supports compile time and runtime cuda support checking */</font>
<a name="line1124">1124: </a>  <font color="#4169E1">if</font> (use_gpu_aware_mpi &amp;&amp; 1 != MPIX_Query_cuda_support()) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,PETSC_ERR_SUP,<font color="#666666">"OpenMPI you used does not support CUDA while you requested -use_gpu_aware_mpi"</font>);
<a name="line1125">1125: </a><font color="#A020F0">#endif</font>
<a name="line1126">1126: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-sf_use_default_cuda_stream"</font>,&amp;sf_use_default_cuda_stream,NULL);
<a name="line1127">1127: </a><font color="#A020F0">#endif</font>

<a name="line1129">1129: </a>  <font color="#4169E1">return</font>(0);
<a name="line1130">1130: </a>}

<a name="line1132">1132: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line1133">1133: </a>PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a> *PetscObjects;
<a name="line1134">1134: </a>PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>    PetscObjectsCounts;
<a name="line1135">1135: </a>PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>    PetscObjectsMaxCounts;
<a name="line1136">1136: </a>PETSC_INTERN <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>   PetscObjectsLog;
<a name="line1137">1137: </a><font color="#A020F0">#endif</font>

<a name="line1139">1139: </a><font color="#B22222">/*</font>
<a name="line1140">1140: </a><font color="#B22222">    Frees all the MPI types and operations that PETSc may have created</font>
<a name="line1141">1141: </a><font color="#B22222">*/</font>
<a name="line1142">1142: </a><strong><font color="#4169E1"><a name="PetscFreeMPIResources"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  PetscFreeMPIResources(void)</font></strong>
<a name="line1143">1143: </a>{

<a name="line1147">1147: </a><font color="#A020F0">#if defined(PETSC_USE_REAL___FLOAT128)</font>
<a name="line1148">1148: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_free.html#MPI_Type_free">MPI_Type_free</a>(&amp;MPIU___FLOAT128);
<a name="line1149">1149: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line1150">1150: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_free.html#MPI_Type_free">MPI_Type_free</a>(&amp;MPIU___COMPLEX128);
<a name="line1151">1151: </a><font color="#A020F0">#endif</font>
<a name="line1152">1152: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_free.html#MPI_Op_free">MPI_Op_free</a>(&amp;MPIU_MAX);
<a name="line1153">1153: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_free.html#MPI_Op_free">MPI_Op_free</a>(&amp;MPIU_MIN);
<a name="line1154">1154: </a><font color="#A020F0">#elif defined(PETSC_USE_REAL___FP16)</font>
<a name="line1155">1155: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_free.html#MPI_Type_free">MPI_Type_free</a>(&amp;MPIU___FP16);
<a name="line1156">1156: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_free.html#MPI_Op_free">MPI_Op_free</a>(&amp;MPIU_MAX);
<a name="line1157">1157: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_free.html#MPI_Op_free">MPI_Op_free</a>(&amp;MPIU_MIN);
<a name="line1158">1158: </a><font color="#A020F0">#endif</font>

<a name="line1160">1160: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line1161">1161: </a><font color="#A020F0">#if !defined(PETSC_HAVE_MPI_C_DOUBLE_COMPLEX)</font>
<a name="line1162">1162: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_free.html#MPI_Type_free">MPI_Type_free</a>(&amp;MPIU_C_DOUBLE_COMPLEX);
<a name="line1163">1163: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_free.html#MPI_Type_free">MPI_Type_free</a>(&amp;MPIU_C_COMPLEX);
<a name="line1164">1164: </a><font color="#A020F0">#endif</font>
<a name="line1165">1165: </a><font color="#A020F0">#endif</font>

<a name="line1167">1167: </a><font color="#A020F0">#if (defined(PETSC_HAVE_COMPLEX) &amp;&amp; !defined(PETSC_HAVE_MPI_C_DOUBLE_COMPLEX)) || defined(PETSC_USE_REAL___FLOAT128) || defined(PETSC_USE_REAL___FP16)</font>
<a name="line1168">1168: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_free.html#MPI_Op_free">MPI_Op_free</a>(&amp;MPIU_SUM);
<a name="line1169">1169: </a><font color="#A020F0">#endif</font>

<a name="line1171">1171: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_free.html#MPI_Type_free">MPI_Type_free</a>(&amp;MPIU_2SCALAR);
<a name="line1172">1172: </a><font color="#A020F0">#if defined(PETSC_USE_64BIT_INDICES)</font>
<a name="line1173">1173: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_free.html#MPI_Type_free">MPI_Type_free</a>(&amp;MPIU_2INT);
<a name="line1174">1174: </a><font color="#A020F0">#endif</font>
<a name="line1175">1175: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_free.html#MPI_Op_free">MPI_Op_free</a>(&amp;MPIU_MAXSUM_OP);
<a name="line1176">1176: </a>  <font color="#4169E1">return</font>(0);
<a name="line1177">1177: </a>}

<a name="line1179">1179: </a><font color="#B22222">/*@C</font>
<a name="line1180">1180: </a><font color="#B22222">   <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a> - Checks for options to be called at the conclusion</font>
<a name="line1181">1181: </a><font color="#B22222">   of the program. <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Finalize.html#MPI_Finalize">MPI_Finalize</a>() is called only if the user had not</font>
<a name="line1182">1182: </a><font color="#B22222">   called <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init.html#MPI_Init">MPI_Init</a>() before calling <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>().</font>

<a name="line1184">1184: </a><font color="#B22222">   Collective on <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a></font>

<a name="line1186">1186: </a><font color="#B22222">   Options Database Keys:</font>
<a name="line1187">1187: </a><font color="#B22222">+  -options_view - Calls <a href="../../../docs/manualpages/Sys/PetscOptionsView.html#PetscOptionsView">PetscOptionsView</a>()</font>
<a name="line1188">1188: </a><font color="#B22222">.  -options_left - Prints unused options that remain in the database</font>
<a name="line1189">1189: </a><font color="#B22222">.  -objects_dump [all] - Prints list of objects allocated by the user that have not been freed, the option all cause all outstanding objects to be listed</font>
<a name="line1190">1190: </a><font color="#B22222">.  -mpidump - Calls <a href="../../../docs/manualpages/Sys/PetscMPIDump.html#PetscMPIDump">PetscMPIDump</a>()</font>
<a name="line1191">1191: </a><font color="#B22222">.  -malloc_dump &lt;optional filename&gt; - Calls <a href="../../../docs/manualpages/Sys/PetscMallocDump.html#PetscMallocDump">PetscMallocDump</a>(), displays all memory allocated that has not been freed</font>
<a name="line1192">1192: </a><font color="#B22222">.  -malloc_info - Prints total memory usage</font>
<a name="line1193">1193: </a><font color="#B22222">-  -malloc_view &lt;optional filename&gt; - Prints list of all memory allocated and where</font>

<a name="line1195">1195: </a><font color="#B22222">   Level: beginner</font>

<a name="line1197">1197: </a><font color="#B22222">   Note:</font>
<a name="line1198">1198: </a><font color="#B22222">   See <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() for more general runtime options.</font>

<a name="line1200">1200: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(), <a href="../../../docs/manualpages/Sys/PetscOptionsView.html#PetscOptionsView">PetscOptionsView</a>(), <a href="../../../docs/manualpages/Sys/PetscMallocDump.html#PetscMallocDump">PetscMallocDump</a>(), <a href="../../../docs/manualpages/Sys/PetscMPIDump.html#PetscMPIDump">PetscMPIDump</a>(), <a href="../../../docs/manualpages/Sys/PetscEnd.html#PetscEnd">PetscEnd</a>()</font>
<a name="line1201">1201: </a><font color="#B22222">@*/</font>
<a name="line1202">1202: </a><strong><font color="#4169E1"><a name="PetscFinalize"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>(void)</font></strong>
<a name="line1203">1203: </a>{
<a name="line1205">1205: </a>  <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>    rank;
<a name="line1206">1206: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       nopt;
<a name="line1207">1207: </a>  <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      flg1 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>,flg2 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>,flg3 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1208">1208: </a>  <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      flg;
<a name="line1209">1209: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line1210">1210: </a>  char           mname[PETSC_MAX_PATH_LEN];
<a name="line1211">1211: </a><font color="#A020F0">#endif</font>

<a name="line1213">1213: </a>  <font color="#4169E1">if</font> (!PetscInitializeCalled) {
<a name="line1214">1214: </a>    printf(<font color="#666666">"<a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() must be called before <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>()\n"</font>);
<a name="line1215">1215: </a>    <font color="#4169E1">return</font>(PETSC_ERR_ARG_WRONGSTATE);
<a name="line1216">1216: </a>  }
<a name="line1218">1218: </a>  <a href="../../../docs/manualpages/Profiling/PetscInfo.html#PetscInfo">PetscInfo</a>(NULL,<font color="#666666">"<a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>() called\n"</font>);

<a name="line1220">1220: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_rank.html#MPI_Comm_rank">MPI_Comm_rank</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,&amp;rank);
<a name="line1221">1221: </a><font color="#A020F0">#if defined(PETSC_HAVE_ADIOS)</font>
<a name="line1222">1222: </a>  adios_read_finalize_method(ADIOS_READ_METHOD_BP_AGGREGATE);
<a name="line1223">1223: </a>  adios_finalize(rank);
<a name="line1224">1224: </a><font color="#A020F0">#endif</font>
<a name="line1225">1225: </a><font color="#A020F0">#if defined(PETSC_HAVE_ADIOS2)</font>
<a name="line1226">1226: </a><font color="#A020F0">#endif</font>
<a name="line1227">1227: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-citations"</font>,&amp;flg);
<a name="line1228">1228: </a>  <font color="#4169E1">if</font> (flg) {
<a name="line1229">1229: </a>    char  *cits, filename[PETSC_MAX_PATH_LEN];
<a name="line1230">1230: </a>    FILE  *fd = PETSC_STDOUT;

<a name="line1232">1232: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-citations"</font>,filename,PETSC_MAX_PATH_LEN,NULL);
<a name="line1233">1233: </a>    <font color="#4169E1">if</font> (filename[0]) {
<a name="line1234">1234: </a>      <a href="../../../docs/manualpages/Sys/PetscFOpen.html#PetscFOpen">PetscFOpen</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,filename,<font color="#666666">"w"</font>,&amp;fd);
<a name="line1235">1235: </a>    }
<a name="line1236">1236: </a>    <a href="../../../docs/manualpages/Sys/PetscSegBufferGet.html#PetscSegBufferGet">PetscSegBufferGet</a>(PetscCitationsList,1,&amp;cits);
<a name="line1237">1237: </a>    cits[0] = 0;
<a name="line1238">1238: </a>    <a href="../../../docs/manualpages/Sys/PetscSegBufferExtractAlloc.html#PetscSegBufferExtractAlloc">PetscSegBufferExtractAlloc</a>(PetscCitationsList,&amp;cits);
<a name="line1239">1239: </a>    <a href="../../../docs/manualpages/Sys/PetscFPrintf.html#PetscFPrintf">PetscFPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,fd,<font color="#666666">"If you publish results based on this computation please cite the following:\n"</font>);
<a name="line1240">1240: </a>    <a href="../../../docs/manualpages/Sys/PetscFPrintf.html#PetscFPrintf">PetscFPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,fd,<font color="#666666">"===========================================================================\n"</font>);
<a name="line1241">1241: </a>    <a href="../../../docs/manualpages/Sys/PetscFPrintf.html#PetscFPrintf">PetscFPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,fd,<font color="#666666">"%s"</font>,cits);
<a name="line1242">1242: </a>    <a href="../../../docs/manualpages/Sys/PetscFPrintf.html#PetscFPrintf">PetscFPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,fd,<font color="#666666">"===========================================================================\n"</font>);
<a name="line1243">1243: </a>    <a href="../../../docs/manualpages/Sys/PetscFClose.html#PetscFClose">PetscFClose</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,fd);
<a name="line1244">1244: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(cits);
<a name="line1245">1245: </a>  }
<a name="line1246">1246: </a>  <a href="../../../docs/manualpages/Sys/PetscSegBufferDestroy.html#PetscSegBufferDestroy">PetscSegBufferDestroy</a>(&amp;PetscCitationsList);

<a name="line1248">1248: </a><font color="#A020F0">#if defined(PETSC_HAVE_SSL) &amp;&amp; defined(PETSC_USE_SOCKET_VIEWER)</font>
<a name="line1249">1249: </a>  <font color="#B22222">/* TextBelt is run for testing purposes only, please do not use this feature often */</font>
<a name="line1250">1250: </a>  {
<a name="line1251">1251: </a>    <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> nmax = 2;
<a name="line1252">1252: </a>    char     **buffs;
<a name="line1253">1253: </a>    <a href="../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(2,&amp;buffs);
<a name="line1254">1254: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetStringArray.html#PetscOptionsGetStringArray">PetscOptionsGetStringArray</a>(NULL,NULL,<font color="#666666">"-textbelt"</font>,buffs,&amp;nmax,&amp;flg1);
<a name="line1255">1255: </a>    <font color="#4169E1">if</font> (flg1) {
<a name="line1256">1256: </a>      <font color="#4169E1">if</font> (!nmax) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,PETSC_ERR_USER,<font color="#666666">"-textbelt requires either the phone number or number,\"message\""</font>);
<a name="line1257">1257: </a>      <font color="#4169E1">if</font> (nmax == 1) {
<a name="line1258">1258: </a>        <a href="../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(128,&amp;buffs[1]);
<a name="line1259">1259: </a>        <a href="../../../docs/manualpages/Sys/PetscGetProgramName.html#PetscGetProgramName">PetscGetProgramName</a>(buffs[1],32);
<a name="line1260">1260: </a>        <a href="../../../docs/manualpages/Sys/PetscStrcat.html#PetscStrcat">PetscStrcat</a>(buffs[1],<font color="#666666">" has completed"</font>);
<a name="line1261">1261: </a>      }
<a name="line1262">1262: </a>      <a href="../../../docs/manualpages/Sys/PetscTextBelt.html#PetscTextBelt">PetscTextBelt</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,buffs[0],buffs[1],NULL);
<a name="line1263">1263: </a>      <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(buffs[0]);
<a name="line1264">1264: </a>      <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(buffs[1]);
<a name="line1265">1265: </a>    }
<a name="line1266">1266: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(buffs);
<a name="line1267">1267: </a>  }
<a name="line1268">1268: </a>  {
<a name="line1269">1269: </a>    <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> nmax = 2;
<a name="line1270">1270: </a>    char     **buffs;
<a name="line1271">1271: </a>    <a href="../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(2,&amp;buffs);
<a name="line1272">1272: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetStringArray.html#PetscOptionsGetStringArray">PetscOptionsGetStringArray</a>(NULL,NULL,<font color="#666666">"-tellmycell"</font>,buffs,&amp;nmax,&amp;flg1);
<a name="line1273">1273: </a>    <font color="#4169E1">if</font> (flg1) {
<a name="line1274">1274: </a>      <font color="#4169E1">if</font> (!nmax) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,PETSC_ERR_USER,<font color="#666666">"-tellmycell requires either the phone number or number,\"message\""</font>);
<a name="line1275">1275: </a>      <font color="#4169E1">if</font> (nmax == 1) {
<a name="line1276">1276: </a>        <a href="../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(128,&amp;buffs[1]);
<a name="line1277">1277: </a>        <a href="../../../docs/manualpages/Sys/PetscGetProgramName.html#PetscGetProgramName">PetscGetProgramName</a>(buffs[1],32);
<a name="line1278">1278: </a>        <a href="../../../docs/manualpages/Sys/PetscStrcat.html#PetscStrcat">PetscStrcat</a>(buffs[1],<font color="#666666">" has completed"</font>);
<a name="line1279">1279: </a>      }
<a name="line1280">1280: </a>      <a href="../../../docs/manualpages/Sys/PetscTellMyCell.html#PetscTellMyCell">PetscTellMyCell</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,buffs[0],buffs[1],NULL);
<a name="line1281">1281: </a>      <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(buffs[0]);
<a name="line1282">1282: </a>      <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(buffs[1]);
<a name="line1283">1283: </a>    }
<a name="line1284">1284: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(buffs);
<a name="line1285">1285: </a>  }
<a name="line1286">1286: </a><font color="#A020F0">#endif</font>
<a name="line1287">1287: </a>  <font color="#B22222">/*</font>
<a name="line1288">1288: </a><font color="#B22222">    It should be safe to cancel the options monitors, since we don't expect to be setting options</font>
<a name="line1289">1289: </a><font color="#B22222">    here (at least that are worth monitoring).  Monitors ought to be released so that they release</font>
<a name="line1290">1290: </a><font color="#B22222">    whatever memory was allocated there before -malloc_dump reports unfreed memory.</font>
<a name="line1291">1291: </a><font color="#B22222">  */</font>
<a name="line1292">1292: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsMonitorCancel.html#PetscOptionsMonitorCancel">PetscOptionsMonitorCancel</a>();

<a name="line1294">1294: </a><font color="#A020F0">#if defined(PETSC_SERIALIZE_FUNCTIONS)</font>
<a name="line1295">1295: </a>  PetscFPTDestroy();
<a name="line1296">1296: </a><font color="#A020F0">#endif</font>


<a name="line1299">1299: </a><font color="#A020F0">#if defined(PETSC_HAVE_SAWS)</font>
<a name="line1300">1300: </a>  flg = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1301">1301: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-saw_options"</font>,&amp;flg,NULL);
<a name="line1302">1302: </a>  <font color="#4169E1">if</font> (flg) {
<a name="line1303">1303: </a>    PetscOptionsSAWsDestroy();
<a name="line1304">1304: </a>  }
<a name="line1305">1305: </a><font color="#A020F0">#endif</font>

<a name="line1307">1307: </a><font color="#A020F0">#if defined(PETSC_HAVE_X)</font>
<a name="line1308">1308: </a>  flg1 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1309">1309: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-x_virtual"</font>,&amp;flg1,NULL);
<a name="line1310">1310: </a>  <font color="#4169E1">if</font> (flg1) {
<a name="line1311">1311: </a>    <font color="#B22222">/*  this is a crude hack, but better than nothing */</font>
<a name="line1312">1312: </a>    <a href="../../../docs/manualpages/Sys/PetscPOpen.html#PetscPOpen">PetscPOpen</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,NULL,<font color="#666666">"pkill -9 Xvfb"</font>,<font color="#666666">"r"</font>,NULL);
<a name="line1313">1313: </a>  }
<a name="line1314">1314: </a><font color="#A020F0">#endif</font>

<a name="line1316">1316: </a><font color="#A020F0">#if !defined(PETSC_HAVE_THREADSAFETY)</font>
<a name="line1317">1317: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-malloc_info"</font>,&amp;flg2,NULL);
<a name="line1318">1318: </a>  <font color="#4169E1">if</font> (!flg2) {
<a name="line1319">1319: </a>    flg2 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1320">1320: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-memory_view"</font>,&amp;flg2,NULL);
<a name="line1321">1321: </a>  }
<a name="line1322">1322: </a>  <font color="#4169E1">if</font> (flg2) {
<a name="line1323">1323: </a>    <a href="../../../docs/manualpages/Sys/PetscMemoryView.html#PetscMemoryView">PetscMemoryView</a>(<a href="../../../docs/manualpages/Viewer/PETSC_VIEWER_STDOUT_WORLD.html#PETSC_VIEWER_STDOUT_WORLD">PETSC_VIEWER_STDOUT_WORLD</a>,<font color="#666666">"Summary of Memory Usage in PETSc\n"</font>);
<a name="line1324">1324: </a>  }
<a name="line1325">1325: </a><font color="#A020F0">#endif</font>

<a name="line1327">1327: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line1328">1328: </a>  flg1 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1329">1329: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-get_total_flops"</font>,&amp;flg1,NULL);
<a name="line1330">1330: </a>  <font color="#4169E1">if</font> (flg1) {
<a name="line1331">1331: </a>    <a href="../../../docs/manualpages/Sys/PetscLogDouble.html#PetscLogDouble">PetscLogDouble</a> flops = 0;
<a name="line1332">1332: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Reduce.html#MPI_Reduce">MPI_Reduce</a>(&amp;petsc_TotalFlops,&amp;flops,1,MPI_DOUBLE,MPI_SUM,0,<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>);
<a name="line1333">1333: </a>    <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"Total flops over all processors %g\n"</font>,flops);
<a name="line1334">1334: </a>  }
<a name="line1335">1335: </a><font color="#A020F0">#endif</font>


<a name="line1338">1338: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line1339">1339: </a><font color="#A020F0">#if defined(PETSC_HAVE_MPE)</font>
<a name="line1340">1340: </a>  mname[0] = 0;
<a name="line1341">1341: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-log_mpe"</font>,mname,PETSC_MAX_PATH_LEN,&amp;flg1);
<a name="line1342">1342: </a>  <font color="#4169E1">if</font> (flg1) {
<a name="line1343">1343: </a>    <font color="#4169E1">if</font> (mname[0]) {<a href="../../../docs/manualpages/Profiling/PetscLogMPEDump.html#PetscLogMPEDump">PetscLogMPEDump</a>(mname);}
<a name="line1344">1344: </a>    <font color="#4169E1">else</font>          {<a href="../../../docs/manualpages/Profiling/PetscLogMPEDump.html#PetscLogMPEDump">PetscLogMPEDump</a>(0);}
<a name="line1345">1345: </a>  }
<a name="line1346">1346: </a><font color="#A020F0">#endif</font>
<a name="line1347">1347: </a><font color="#A020F0">#endif</font>

<a name="line1349">1349: </a>  <font color="#B22222">/*</font>
<a name="line1350">1350: </a><font color="#B22222">     Free all objects registered with <a href="../../../docs/manualpages/Sys/PetscObjectRegisterDestroy.html#PetscObjectRegisterDestroy">PetscObjectRegisterDestroy</a>() such as PETSC_VIEWER_XXX_().</font>
<a name="line1351">1351: </a><font color="#B22222">  */</font>
<a name="line1352">1352: </a>  <a href="../../../docs/manualpages/Sys/PetscObjectRegisterDestroyAll.html#PetscObjectRegisterDestroyAll">PetscObjectRegisterDestroyAll</a>();

<a name="line1354">1354: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line1355">1355: </a>  <a href="../../../docs/manualpages/Viewer/PetscOptionsPushGetViewerOff.html#PetscOptionsPushGetViewerOff">PetscOptionsPushGetViewerOff</a>(<a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>);
<a name="line1356">1356: </a>  <a href="../../../docs/manualpages/Profiling/PetscLogViewFromOptions.html#PetscLogViewFromOptions">PetscLogViewFromOptions</a>();
<a name="line1357">1357: </a>  <a href="../../../docs/manualpages/Viewer/PetscOptionsPopGetViewerOff.html#PetscOptionsPopGetViewerOff">PetscOptionsPopGetViewerOff</a>();

<a name="line1359">1359: </a>  mname[0] = 0;
<a name="line1360">1360: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-log_summary"</font>,mname,PETSC_MAX_PATH_LEN,&amp;flg1);
<a name="line1361">1361: </a>  <font color="#4169E1">if</font> (flg1) {
<a name="line1362">1362: </a>    <a href="../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> viewer;
<a name="line1363">1363: </a>    (*<a href="../../../docs/manualpages/Sys/PetscHelpPrintf.html#PetscHelpPrintf">PetscHelpPrintf</a>)(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"\n\n WARNING:   -log_summary is being deprecated; switch to -log_view\n\n\n"</font>);
<a name="line1364">1364: </a>    <font color="#4169E1">if</font> (mname[0]) {
<a name="line1365">1365: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerASCIIOpen.html#PetscViewerASCIIOpen">PetscViewerASCIIOpen</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,mname,&amp;viewer);
<a name="line1366">1366: </a>      <a href="../../../docs/manualpages/Profiling/PetscLogView.html#PetscLogView">PetscLogView</a>(viewer);
<a name="line1367">1367: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerDestroy.html#PetscViewerDestroy">PetscViewerDestroy</a>(&amp;viewer);
<a name="line1368">1368: </a>    } <font color="#4169E1">else</font> {
<a name="line1369">1369: </a>      viewer = <a href="../../../docs/manualpages/Viewer/PETSC_VIEWER_STDOUT_WORLD.html#PETSC_VIEWER_STDOUT_WORLD">PETSC_VIEWER_STDOUT_WORLD</a>;
<a name="line1370">1370: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerPushFormat.html#PetscViewerPushFormat">PetscViewerPushFormat</a>(viewer,<a href="../../../docs/manualpages/Viewer/PetscViewerFormat.html#PetscViewerFormat">PETSC_VIEWER_DEFAULT</a>);
<a name="line1371">1371: </a>      <a href="../../../docs/manualpages/Profiling/PetscLogView.html#PetscLogView">PetscLogView</a>(viewer);
<a name="line1372">1372: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerPopFormat.html#PetscViewerPopFormat">PetscViewerPopFormat</a>(viewer);
<a name="line1373">1373: </a>    }
<a name="line1374">1374: </a>  }

<a name="line1376">1376: </a>  <font color="#B22222">/*</font>
<a name="line1377">1377: </a><font color="#B22222">     Free any objects created by the last block of code.</font>
<a name="line1378">1378: </a><font color="#B22222">  */</font>
<a name="line1379">1379: </a>  <a href="../../../docs/manualpages/Sys/PetscObjectRegisterDestroyAll.html#PetscObjectRegisterDestroyAll">PetscObjectRegisterDestroyAll</a>();

<a name="line1381">1381: </a>  mname[0] = 0;
<a name="line1382">1382: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-log_all"</font>,mname,PETSC_MAX_PATH_LEN,&amp;flg1);
<a name="line1383">1383: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-log"</font>,mname,PETSC_MAX_PATH_LEN,&amp;flg2);
<a name="line1384">1384: </a>  <font color="#4169E1">if</font> (flg1 || flg2) {<a href="../../../docs/manualpages/Profiling/PetscLogDump.html#PetscLogDump">PetscLogDump</a>(mname);}
<a name="line1385">1385: </a><font color="#A020F0">#endif</font>

<a name="line1387">1387: </a>  PetscStackDestroy();

<a name="line1389">1389: </a>  flg1 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1390">1390: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-no_signal_handler"</font>,&amp;flg1,NULL);
<a name="line1391">1391: </a>  <font color="#4169E1">if</font> (!flg1) { <a href="../../../docs/manualpages/Sys/PetscPopSignalHandler.html#PetscPopSignalHandler">PetscPopSignalHandler</a>();}
<a name="line1392">1392: </a>  flg1 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1393">1393: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-mpidump"</font>,&amp;flg1,NULL);
<a name="line1394">1394: </a>  <font color="#4169E1">if</font> (flg1) {
<a name="line1395">1395: </a>    <a href="../../../docs/manualpages/Sys/PetscMPIDump.html#PetscMPIDump">PetscMPIDump</a>(stdout);
<a name="line1396">1396: </a>  }
<a name="line1397">1397: </a>  flg1 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1398">1398: </a>  flg2 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1399">1399: </a>  <font color="#B22222">/* preemptive call to avoid listing this option in options table as unused */</font>
<a name="line1400">1400: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-malloc_dump"</font>,&amp;flg1);
<a name="line1401">1401: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-objects_dump"</font>,&amp;flg1);
<a name="line1402">1402: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-options_view"</font>,&amp;flg2,NULL);

<a name="line1404">1404: </a>  <font color="#4169E1">if</font> (flg2) {
<a name="line1405">1405: </a>    <a href="../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> viewer;
<a name="line1406">1406: </a>    <a href="../../../docs/manualpages/Viewer/PetscViewerCreate.html#PetscViewerCreate">PetscViewerCreate</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,&amp;viewer);
<a name="line1407">1407: </a>    <a href="../../../docs/manualpages/Viewer/PetscViewerSetType.html#PetscViewerSetType">PetscViewerSetType</a>(viewer,<a href="../../../docs/manualpages/Viewer/PETSCVIEWERASCII.html#PETSCVIEWERASCII">PETSCVIEWERASCII</a>);
<a name="line1408">1408: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsView.html#PetscOptionsView">PetscOptionsView</a>(NULL,viewer);
<a name="line1409">1409: </a>    <a href="../../../docs/manualpages/Viewer/PetscViewerDestroy.html#PetscViewerDestroy">PetscViewerDestroy</a>(&amp;viewer);
<a name="line1410">1410: </a>  }

<a name="line1412">1412: </a>  <font color="#B22222">/* to prevent PETSc -options_left from warning */</font>
<a name="line1413">1413: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-nox"</font>,&amp;flg1);
<a name="line1414">1414: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-nox_warning"</font>,&amp;flg1);

<a name="line1416">1416: </a>  flg3 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>; <font color="#B22222">/* default value is required */</font>
<a name="line1417">1417: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-options_left"</font>,&amp;flg3,&amp;flg1);
<a name="line1418">1418: </a><font color="#A020F0">#if defined(PETSC_USE_DEBUG)</font>
<a name="line1419">1419: </a>  <font color="#4169E1">if</font> (!flg1) flg3 = <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1420">1420: </a><font color="#A020F0">#endif</font>
<a name="line1421">1421: </a>  <font color="#4169E1">if</font> (flg3) {
<a name="line1422">1422: </a>    <font color="#4169E1">if</font> (!flg2 &amp;&amp; flg1) { <font color="#B22222">/* have not yet printed the options */</font>
<a name="line1423">1423: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> viewer;
<a name="line1424">1424: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerCreate.html#PetscViewerCreate">PetscViewerCreate</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,&amp;viewer);
<a name="line1425">1425: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerSetType.html#PetscViewerSetType">PetscViewerSetType</a>(viewer,<a href="../../../docs/manualpages/Viewer/PETSCVIEWERASCII.html#PETSCVIEWERASCII">PETSCVIEWERASCII</a>);
<a name="line1426">1426: </a>      <a href="../../../docs/manualpages/Sys/PetscOptionsView.html#PetscOptionsView">PetscOptionsView</a>(NULL,viewer);
<a name="line1427">1427: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerDestroy.html#PetscViewerDestroy">PetscViewerDestroy</a>(&amp;viewer);
<a name="line1428">1428: </a>    }
<a name="line1429">1429: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsAllUsed.html#PetscOptionsAllUsed">PetscOptionsAllUsed</a>(NULL,&amp;nopt);
<a name="line1430">1430: </a>    <font color="#4169E1">if</font> (nopt) {
<a name="line1431">1431: </a>      <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"WARNING! There are options you set that were not used!\n"</font>);
<a name="line1432">1432: </a>      <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"WARNING! could be spelling mistake, etc!\n"</font>);
<a name="line1433">1433: </a>      <font color="#4169E1">if</font> (nopt == 1) {
<a name="line1434">1434: </a>        <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"There is one unused database option. It is:\n"</font>);
<a name="line1435">1435: </a>      } <font color="#4169E1">else</font> {
<a name="line1436">1436: </a>        <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"There are %D unused database options. They are:\n"</font>,nopt);
<a name="line1437">1437: </a>      }
<a name="line1438">1438: </a>    } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (flg3 &amp;&amp; flg1) {
<a name="line1439">1439: </a>      <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"There are no unused options.\n"</font>);
<a name="line1440">1440: </a>    }
<a name="line1441">1441: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsLeft.html#PetscOptionsLeft">PetscOptionsLeft</a>(NULL);
<a name="line1442">1442: </a>  }

<a name="line1444">1444: </a><font color="#A020F0">#if defined(PETSC_HAVE_SAWS)</font>
<a name="line1445">1445: </a>  <font color="#4169E1">if</font> (!PetscGlobalRank) {
<a name="line1446">1446: </a>    PetscStackSAWsViewOff();
<a name="line1447">1447: </a>    PetscStackCallSAWs(SAWs_Finalize,());
<a name="line1448">1448: </a>  }
<a name="line1449">1449: </a><font color="#A020F0">#endif</font>

<a name="line1451">1451: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line1452">1452: </a>  <font color="#B22222">/*</font>
<a name="line1453">1453: </a><font color="#B22222">       List all objects the user may have forgot to free</font>
<a name="line1454">1454: </a><font color="#B22222">  */</font>
<a name="line1455">1455: </a>  <font color="#4169E1">if</font> (PetscObjectsLog) {
<a name="line1456">1456: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-objects_dump"</font>,&amp;flg1);
<a name="line1457">1457: </a>    <font color="#4169E1">if</font> (flg1) {
<a name="line1458">1458: </a>      <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> local_comm;
<a name="line1459">1459: </a>      char     string[64];

<a name="line1461">1461: </a>      <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-objects_dump"</font>,string,64,NULL);
<a name="line1462">1462: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_dup.html#MPI_Comm_dup">MPI_Comm_dup</a>(MPI_COMM_WORLD,&amp;local_comm);
<a name="line1463">1463: </a>      PetscSequentialPhaseBegin_Private(local_comm,1);
<a name="line1464">1464: </a>      <a href="../../../docs/manualpages/Sys/PetscObjectsDump.html#PetscObjectsDump">PetscObjectsDump</a>(stdout,(string[0] == 'a') ? <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a> : <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>);
<a name="line1465">1465: </a>      PetscSequentialPhaseEnd_Private(local_comm,1);
<a name="line1466">1466: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>(&amp;local_comm);
<a name="line1467">1467: </a>    }
<a name="line1468">1468: </a>  }
<a name="line1469">1469: </a><font color="#A020F0">#endif</font>

<a name="line1471">1471: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line1472">1472: </a>  PetscObjectsCounts    = 0;
<a name="line1473">1473: </a>  PetscObjectsMaxCounts = 0;
<a name="line1474">1474: </a>  <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(PetscObjects);
<a name="line1475">1475: </a><font color="#A020F0">#endif</font>

<a name="line1477">1477: </a>  <font color="#B22222">/*</font>
<a name="line1478">1478: </a><font color="#B22222">     Destroy any packages that registered a finalize</font>
<a name="line1479">1479: </a><font color="#B22222">  */</font>
<a name="line1480">1480: </a>  <a href="../../../docs/manualpages/Sys/PetscRegisterFinalizeAll.html#PetscRegisterFinalizeAll">PetscRegisterFinalizeAll</a>();

<a name="line1482">1482: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line1483">1483: </a>  PetscLogFinalize();
<a name="line1484">1484: </a><font color="#A020F0">#endif</font>

<a name="line1486">1486: </a>  <font color="#B22222">/*</font>
<a name="line1487">1487: </a><font color="#B22222">     Print PetscFunctionLists that have not been properly freed</font>

<a name="line1489">1489: </a><font color="#B22222">  PetscFunctionListPrintAll();</font>
<a name="line1490">1490: </a><font color="#B22222">  */</font>

<a name="line1492">1492: </a>  <font color="#4169E1">if</font> (petsc_history) {
<a name="line1493">1493: </a>    PetscCloseHistoryFile(&amp;petsc_history);
<a name="line1494">1494: </a>    petsc_history = 0;
<a name="line1495">1495: </a>  }
<a name="line1496">1496: </a>  PetscOptionsHelpPrintedDestroy(&amp;PetscOptionsHelpPrintedSingleton);

<a name="line1498">1498: </a>  <a href="../../../docs/manualpages/Profiling/PetscInfoAllow.html#PetscInfoAllow">PetscInfoAllow</a>(<a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>,NULL);

<a name="line1500">1500: </a><font color="#A020F0">#if !defined(PETSC_HAVE_THREADSAFETY)</font>
<a name="line1501">1501: </a>  <font color="#4169E1">if</font> (!(PETSC_RUNNING_ON_VALGRIND)) {
<a name="line1502">1502: </a>    char fname[PETSC_MAX_PATH_LEN];
<a name="line1503">1503: </a>    char sname[PETSC_MAX_PATH_LEN];
<a name="line1504">1504: </a>    FILE *fd;
<a name="line1505">1505: </a>    int  err;

<a name="line1507">1507: </a>    flg2 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1508">1508: </a>    flg3 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1509">1509: </a><font color="#A020F0">#if defined(PETSC_USE_DEBUG)</font>
<a name="line1510">1510: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-malloc_test"</font>,&amp;flg2,NULL);
<a name="line1511">1511: </a><font color="#A020F0">#endif</font>
<a name="line1512">1512: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-malloc_debug"</font>,&amp;flg3,NULL);
<a name="line1513">1513: </a>    fname[0] = 0;
<a name="line1514">1514: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-malloc_dump"</font>,fname,250,&amp;flg1);
<a name="line1515">1515: </a>    <font color="#4169E1">if</font> (flg1 &amp;&amp; fname[0]) {

<a name="line1517">1517: </a>      <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(sname,PETSC_MAX_PATH_LEN,<font color="#666666">"%s_%d"</font>,fname,rank);
<a name="line1518">1518: </a>      fd   = fopen(sname,<font color="#666666">"w"</font>); <font color="#4169E1">if</font> (!fd) <a href="../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_FILE_OPEN,<font color="#666666">"Cannot open log file: %s"</font>,sname);
<a name="line1519">1519: </a>      <a href="../../../docs/manualpages/Sys/PetscMallocDump.html#PetscMallocDump">PetscMallocDump</a>(fd);
<a name="line1520">1520: </a>      err  = fclose(fd);
<a name="line1521">1521: </a>      <font color="#4169E1">if</font> (err) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_SYS,<font color="#666666">"fclose() failed on file"</font>);
<a name="line1522">1522: </a>    } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (flg1 || flg2 || flg3) {
<a name="line1523">1523: </a>      <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> local_comm;

<a name="line1525">1525: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_dup.html#MPI_Comm_dup">MPI_Comm_dup</a>(MPI_COMM_WORLD,&amp;local_comm);
<a name="line1526">1526: </a>      PetscSequentialPhaseBegin_Private(local_comm,1);
<a name="line1527">1527: </a>      <a href="../../../docs/manualpages/Sys/PetscMallocDump.html#PetscMallocDump">PetscMallocDump</a>(stdout);
<a name="line1528">1528: </a>      PetscSequentialPhaseEnd_Private(local_comm,1);
<a name="line1529">1529: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>(&amp;local_comm);
<a name="line1530">1530: </a>    }
<a name="line1531">1531: </a>    fname[0] = 0;
<a name="line1532">1532: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-malloc_view"</font>,fname,250,&amp;flg1);
<a name="line1533">1533: </a>    <font color="#4169E1">if</font> (flg1 &amp;&amp; fname[0]) {

<a name="line1535">1535: </a>      <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(sname,PETSC_MAX_PATH_LEN,<font color="#666666">"%s_%d"</font>,fname,rank);
<a name="line1536">1536: </a>      fd   = fopen(sname,<font color="#666666">"w"</font>); <font color="#4169E1">if</font> (!fd) <a href="../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_FILE_OPEN,<font color="#666666">"Cannot open log file: %s"</font>,sname);
<a name="line1537">1537: </a>      <a href="../../../docs/manualpages/Sys/PetscMallocView.html#PetscMallocView">PetscMallocView</a>(fd);
<a name="line1538">1538: </a>      err  = fclose(fd);
<a name="line1539">1539: </a>      <font color="#4169E1">if</font> (err) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_SYS,<font color="#666666">"fclose() failed on file"</font>);
<a name="line1540">1540: </a>    } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (flg1) {
<a name="line1541">1541: </a>      <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> local_comm;

<a name="line1543">1543: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_dup.html#MPI_Comm_dup">MPI_Comm_dup</a>(MPI_COMM_WORLD,&amp;local_comm);
<a name="line1544">1544: </a>      PetscSequentialPhaseBegin_Private(local_comm,1);
<a name="line1545">1545: </a>      <a href="../../../docs/manualpages/Sys/PetscMallocView.html#PetscMallocView">PetscMallocView</a>(stdout);
<a name="line1546">1546: </a>      PetscSequentialPhaseEnd_Private(local_comm,1);
<a name="line1547">1547: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>(&amp;local_comm);
<a name="line1548">1548: </a>    }
<a name="line1549">1549: </a>  }
<a name="line1550">1550: </a><font color="#A020F0">#endif</font>

<a name="line1552">1552: </a>  <font color="#B22222">/*</font>
<a name="line1553">1553: </a><font color="#B22222">     Close any open dynamic libraries</font>
<a name="line1554">1554: </a><font color="#B22222">  */</font>
<a name="line1555">1555: </a>  PetscFinalize_DynamicLibraries();

<a name="line1557">1557: </a>  <font color="#B22222">/* Can be destroyed only after all the options are used */</font>
<a name="line1558">1558: </a>  PetscOptionsDestroyDefault();

<a name="line1560">1560: </a>  PetscGlobalArgc = 0;
<a name="line1561">1561: </a>  PetscGlobalArgs = 0;

<a name="line1563">1563: </a>  PetscFreeMPIResources();

<a name="line1565">1565: </a>  <font color="#B22222">/*</font>
<a name="line1566">1566: </a><font color="#B22222">     Destroy any known inner <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a>'s and attributes pointing to them</font>
<a name="line1567">1567: </a><font color="#B22222">     Note this will not destroy any new communicators the user has created.</font>

<a name="line1569">1569: </a><font color="#B22222">     If all PETSc objects were not destroyed those left over objects will have hanging references to</font>
<a name="line1570">1570: </a><font color="#B22222">     the MPI_Comms that were freed; but that is ok because those PETSc objects will never be used again</font>
<a name="line1571">1571: </a><font color="#B22222"> */</font>
<a name="line1572">1572: </a>  {
<a name="line1573">1573: </a>    PetscCommCounter *counter;
<a name="line1574">1574: </a>    <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>      flg;
<a name="line1575">1575: </a>    <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a>         icomm;
<a name="line1576">1576: </a>    <font color="#4169E1">union</font> {<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm; void *ptr;} ucomm;
<a name="line1577">1577: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_get_attr.html#MPI_Comm_get_attr">MPI_Comm_get_attr</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,Petsc_InnerComm_keyval,&amp;ucomm,&amp;flg);
<a name="line1578">1578: </a>    <font color="#4169E1">if</font> (flg) {
<a name="line1579">1579: </a>      icomm = ucomm.comm;
<a name="line1580">1580: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_get_attr.html#MPI_Comm_get_attr">MPI_Comm_get_attr</a>(icomm,Petsc_Counter_keyval,&amp;counter,&amp;flg);
<a name="line1581">1581: </a>      <font color="#4169E1">if</font> (!flg) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_ARG_CORRUPT,<font color="#666666">"Inner <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> does not have expected tag/name counter, problem with corrupted memory"</font>);

<a name="line1583">1583: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_delete_attr.html#MPI_Comm_delete_attr">MPI_Comm_delete_attr</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,Petsc_InnerComm_keyval);
<a name="line1584">1584: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_delete_attr.html#MPI_Comm_delete_attr">MPI_Comm_delete_attr</a>(icomm,Petsc_Counter_keyval);
<a name="line1585">1585: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>(&amp;icomm);
<a name="line1586">1586: </a>    }
<a name="line1587">1587: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_get_attr.html#MPI_Comm_get_attr">MPI_Comm_get_attr</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,Petsc_InnerComm_keyval,&amp;ucomm,&amp;flg);
<a name="line1588">1588: </a>    <font color="#4169E1">if</font> (flg) {
<a name="line1589">1589: </a>      icomm = ucomm.comm;
<a name="line1590">1590: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_get_attr.html#MPI_Comm_get_attr">MPI_Comm_get_attr</a>(icomm,Petsc_Counter_keyval,&amp;counter,&amp;flg);
<a name="line1591">1591: </a>      <font color="#4169E1">if</font> (!flg) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,PETSC_ERR_ARG_CORRUPT,<font color="#666666">"Inner <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> does not have expected tag/name counter, problem with corrupted memory"</font>);

<a name="line1593">1593: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_delete_attr.html#MPI_Comm_delete_attr">MPI_Comm_delete_attr</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,Petsc_InnerComm_keyval);
<a name="line1594">1594: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_delete_attr.html#MPI_Comm_delete_attr">MPI_Comm_delete_attr</a>(icomm,Petsc_Counter_keyval);
<a name="line1595">1595: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>(&amp;icomm);
<a name="line1596">1596: </a>    }
<a name="line1597">1597: </a>  }

<a name="line1599">1599: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free_keyval.html#MPI_Comm_free_keyval">MPI_Comm_free_keyval</a>(&amp;Petsc_Counter_keyval);
<a name="line1600">1600: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free_keyval.html#MPI_Comm_free_keyval">MPI_Comm_free_keyval</a>(&amp;Petsc_InnerComm_keyval);
<a name="line1601">1601: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free_keyval.html#MPI_Comm_free_keyval">MPI_Comm_free_keyval</a>(&amp;Petsc_OuterComm_keyval);
<a name="line1602">1602: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free_keyval.html#MPI_Comm_free_keyval">MPI_Comm_free_keyval</a>(&amp;Petsc_ShmComm_keyval);

<a name="line1604">1604: </a>  PetscSpinlockDestroy(&amp;PetscViewerASCIISpinLockOpen);
<a name="line1605">1605: </a>  PetscSpinlockDestroy(&amp;PetscViewerASCIISpinLockStdout);
<a name="line1606">1606: </a>  PetscSpinlockDestroy(&amp;PetscViewerASCIISpinLockStderr);
<a name="line1607">1607: </a>  PetscSpinlockDestroy(&amp;PetscCommSpinLock);

<a name="line1609">1609: </a>  <font color="#4169E1">if</font> (PetscBeganMPI) {
<a name="line1610">1610: </a><font color="#A020F0">#if defined(PETSC_HAVE_MPI_FINALIZED)</font>
<a name="line1611">1611: </a>    <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> flag;
<a name="line1612">1612: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Finalized.html#MPI_Finalized">MPI_Finalized</a>(&amp;flag);
<a name="line1613">1613: </a>    <font color="#4169E1">if</font> (flag) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_LIB,<font color="#666666">"<a href="http://www.mpich.org/static/docs/latest/www3/MPI_Finalize.html#MPI_Finalize">MPI_Finalize</a>() has already been called, even though <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init.html#MPI_Init">MPI_Init</a>() was called by <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>()"</font>);
<a name="line1614">1614: </a><font color="#A020F0">#endif</font>
<a name="line1615">1615: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Finalize.html#MPI_Finalize">MPI_Finalize</a>();
<a name="line1616">1616: </a>  }
<a name="line1617">1617: </a><font color="#B22222">/*</font>

<a name="line1619">1619: </a><font color="#B22222">     Note: In certain cases <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> is never <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>()ed because</font>
<a name="line1620">1620: </a><font color="#B22222">   the communicator has some outstanding requests on it. Specifically if the</font>
<a name="line1621">1621: </a><font color="#B22222">   flag PETSC_HAVE_BROKEN_REQUEST_FREE is set (for IBM MPI implementation). See</font>
<a name="line1622">1622: </a><font color="#B22222">   src/vec/utils/vpscat.c. Due to this the memory allocated in <a href="../../../docs/manualpages/Sys/PetscCommDuplicate.html#PetscCommDuplicate">PetscCommDuplicate</a>()</font>
<a name="line1623">1623: </a><font color="#B22222">   is never freed as it should be. Thus one may obtain messages of the form</font>
<a name="line1624">1624: </a><font color="#B22222">   [ 1] 8 bytes <a href="../../../docs/manualpages/Sys/PetscCommDuplicate.html#PetscCommDuplicate">PetscCommDuplicate</a>() line 645 in src/sys/mpiu.c indicating the</font>
<a name="line1625">1625: </a><font color="#B22222">   memory was not freed.</font>

<a name="line1627">1627: </a><font color="#B22222">*/</font>
<a name="line1628">1628: </a>  <a href="../../../docs/manualpages/Sys/PetscMallocClear.html#PetscMallocClear">PetscMallocClear</a>();

<a name="line1630">1630: </a>  PetscInitializeCalled = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1631">1631: </a>  PetscFinalizeCalled   = <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1632">1632: </a>  <font color="#4169E1">return</font>(0);
<a name="line1633">1633: </a>}

<a name="line1635">1635: </a><font color="#A020F0">#if defined(PETSC_MISSING_LAPACK_lsame_)</font>
<a name="line1636">1636: </a><strong><font color="#4169E1"><a name="lsame_"></a>PETSC_EXTERN int lsame_(char *a,char *b)</font></strong>
<a name="line1637">1637: </a>{
<a name="line1638">1638: </a>  <font color="#4169E1">if</font> (*a == *b) <font color="#4169E1">return</font> 1;
<a name="line1639">1639: </a>  <font color="#4169E1">if</font> (*a + 32 == *b) <font color="#4169E1">return</font> 1;
<a name="line1640">1640: </a>  <font color="#4169E1">if</font> (*a - 32 == *b) <font color="#4169E1">return</font> 1;
<a name="line1641">1641: </a>  <font color="#4169E1">return</font> 0;
<a name="line1642">1642: </a>}
<a name="line1643">1643: </a><font color="#A020F0">#endif</font>

<a name="line1645">1645: </a><font color="#A020F0">#if defined(PETSC_MISSING_LAPACK_lsame)</font>
<a name="line1646">1646: </a><strong><font color="#4169E1"><a name="lsame"></a>PETSC_EXTERN int lsame(char *a,char *b)</font></strong>
<a name="line1647">1647: </a>{
<a name="line1648">1648: </a>  <font color="#4169E1">if</font> (*a == *b) <font color="#4169E1">return</font> 1;
<a name="line1649">1649: </a>  <font color="#4169E1">if</font> (*a + 32 == *b) <font color="#4169E1">return</font> 1;
<a name="line1650">1650: </a>  <font color="#4169E1">if</font> (*a - 32 == *b) <font color="#4169E1">return</font> 1;
<a name="line1651">1651: </a>  <font color="#4169E1">return</font> 0;
<a name="line1652">1652: </a>}
<a name="line1653">1653: </a><font color="#A020F0">#endif</font>
</pre>
</body>

</html>
